import"./chunk-5EJW5QKE.js";import{$ as Pn,A as Dr,B as dt,C as _o,D as yo,E as vo,F as wo,G as ft,H as fn,I as mn,J as Ue,K as pn,L as gn,M as _n,N as yn,O as vn,P as ce,Q as wn,R as En,S as In,T as Tn,U as Cn,V as Sn,W as An,X as Rn,Y as Eo,Z as Io,aa as To,c as oo,ca as Co,d as ao,g as lo,i as f,j as qe,k as co,l as uo,m as ho,n as un,o as xr,p as hn,q as Nr,r as fo,s as ae,t as mo,u as dn,v as N,w as po,x as go,y as le,z as Ae}from"./chunk-ZDTS5WPX.js";import{$ as oe,Ga as cn,Ua as so,V as sn,X as on,d as ve,da as ro,db as io,ea as an,ha as ht,qa as ln}from"./chunk-T3SVGVHJ.js";var So=[{path:"",loadComponent:()=>import("./chunk-6Q73JA2Q.js").then(e=>e.HomeComponent)},{path:"home",loadComponent:()=>import("./chunk-6Q73JA2Q.js").then(e=>e.HomeComponent)},{path:"login",loadComponent:()=>import("./chunk-F7KSLDUD.js").then(e=>e.LoginVerificacionComponent)},{path:"quien-soy",loadComponent:()=>import("./chunk-6DCED5E4.js").then(e=>e.QuienSoyComponent)},{path:"registrarse",loadComponent:()=>import("./chunk-T7OC4LJH.js").then(e=>e.RegistrarseVerificacionComponent)},{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",loadComponent:()=>import("./chunk-TSIMEFGP.js").then(e=>e.ErrorComponent)}];var Xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ne={},m,es=es||{},p=Xc||self;function Gn(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function Rt(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function Jc(e){return Object.prototype.hasOwnProperty.call(e,kr)&&e[kr]||(e[kr]=++Zc)}var kr="closure_uid_"+(1e9*Math.random()>>>0),Zc=0;function eu(e,t,n){return e.call.apply(e.bind,arguments)}function tu(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function q(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?q=eu:q=tu,q.apply(null,arguments)}function bn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function k(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[s].apply(r,o)}}function we(){this.s=this.s,this.o=this.o}var nu=0;we.prototype.s=!1;we.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),nu!=0)&&Jc(this)};we.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Lo=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function ts(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Ao(e,t){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(Gn(r)){let s=e.length||0,i=r.length||0;e.length=s+i;for(let o=0;o<i;o++)e[s+o]=r[o]}else e.push(r)}}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var ru=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let n=()=>{};p.addEventListener("test",n,t),p.removeEventListener("test",n,t)}catch{}return e}();function vt(e){return/^[\s\xa0]*$/.test(e)}function $n(){var e=p.navigator;return e&&(e=e.userAgent)?e:""}function ue(e){return $n().indexOf(e)!=-1}function ns(e){return ns[" "](e),e}ns[" "]=function(){};function su(e,t){var n=ju;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var iu=ue("Opera"),ze=ue("Trident")||ue("MSIE"),qo=ue("Edge"),Lr=qo||ze,Uo=ue("Gecko")&&!($n().toLowerCase().indexOf("webkit")!=-1&&!ue("Edge"))&&!(ue("Trident")||ue("MSIE"))&&!ue("Edge"),ou=$n().toLowerCase().indexOf("webkit")!=-1&&!ue("Edge");function Bo(){var e=p.document;return e?e.documentMode:void 0}var qr;e:{if(xn="",Nn=function(){var e=$n();if(Uo)return/rv:([^\);]+)(\)|;)/.exec(e);if(qo)return/Edge\/([\d\.]+)/.exec(e);if(ze)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(ou)return/WebKit\/(\S+)/.exec(e);if(iu)return/(?:Version)[ \/]?(\S+)/.exec(e)}(),Nn&&(xn=Nn?Nn[1]:""),ze&&(Dn=Bo(),Dn!=null&&Dn>parseFloat(xn))){qr=String(Dn);break e}qr=xn}var xn,Nn,Dn,Ur;p.document&&ze?(Vr=Bo(),Ur=Vr||parseInt(qr,10)||void 0):Ur=void 0;var Vr,au=Ur;function wt(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Uo){e:{try{ns(t.nodeName);var s=!0;break e}catch{}s=!1}s||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:lu[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&wt.$.h.call(this)}}k(wt,U);var lu={2:"touch",3:"pen",4:"mouse"};wt.prototype.h=function(){wt.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Pt="closure_listenable_"+(1e6*Math.random()|0),cu=0;function uu(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=s,this.key=++cu,this.fa=this.ia=!1}function zn(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function rs(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function hu(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function Go(e){let t={};for(let n in e)t[n]=e[n];return t}var Ro="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $o(e,t){let n,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(n in r)e[n]=r[n];for(let i=0;i<Ro.length;i++)n=Ro[i],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Kn(e){this.src=e,this.g={},this.h=0}Kn.prototype.add=function(e,t,n,r,s){var i=e.toString();e=this.g[i],e||(e=this.g[i]=[],this.h++);var o=Gr(e,t,r,s);return-1<o?(t=e[o],n||(t.ia=!1)):(t=new uu(t,this.src,i,!!r,s),t.ia=n,e.push(t)),t};function Br(e,t){var n=t.type;if(n in e.g){var r=e.g[n],s=Lo(r,t),i;(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(zn(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function Gr(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.fa&&i.listener==t&&i.capture==!!n&&i.la==r)return s}return-1}var ss="closure_lm_"+(1e6*Math.random()|0),Fr={};function zo(e,t,n,r,s){if(r&&r.once)return jo(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)zo(e,t[i],n,r,s);return null}return n=as(n),e&&e[Pt]?e.O(t,n,Rt(r)?!!r.capture:!!r,s):Ko(e,t,n,!1,r,s)}function Ko(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o=Rt(s)?!!s.capture:!!s,a=os(e);if(a||(e[ss]=a=new Kn(e)),n=a.add(t,n,r,o,i),n.proxy)return n;if(r=du(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ru||(s=o),s===void 0&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Qo(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function du(){function e(n){return t.call(e.src,e.listener,n)}let t=fu;return e}function jo(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)jo(e,t[i],n,r,s);return null}return n=as(n),e&&e[Pt]?e.P(t,n,Rt(r)?!!r.capture:!!r,s):Ko(e,t,n,!0,r,s)}function Wo(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)Wo(e,t[i],n,r,s);else r=Rt(r)?!!r.capture:!!r,n=as(n),e&&e[Pt]?(e=e.i,t=String(t).toString(),t in e.g&&(i=e.g[t],n=Gr(i,n,r,s),-1<n&&(zn(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete e.g[t],e.h--)))):e&&(e=os(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Gr(t,n,r,s)),(n=-1<e?t[e]:null)&&is(n))}function is(e){if(typeof e!="number"&&e&&!e.fa){var t=e.src;if(t&&t[Pt])Br(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Qo(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=os(t))?(Br(n,e),n.h==0&&(n.src=null,t[ss]=null)):zn(e)}}}function Qo(e){return e in Fr?Fr[e]:Fr[e]="on"+e}function fu(e,t){if(e.fa)e=!0;else{t=new wt(t,this);var n=e.listener,r=e.la||e.src;e.ia&&is(e),e=n.call(r,t)}return e}function os(e){return e=e[ss],e instanceof Kn?e:null}var Mr="__closure_events_fn_"+(1e9*Math.random()>>>0);function as(e){return typeof e=="function"?e:(e[Mr]||(e[Mr]=function(t){return e.handleEvent(t)}),e[Mr])}function D(){we.call(this),this.i=new Kn(this),this.S=this,this.J=null}k(D,we);D.prototype[Pt]=!0;D.prototype.removeEventListener=function(e,t,n,r){Wo(this,e,t,n,r)};function O(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,typeof t=="string")t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var s=t;t=new U(r,e),$o(t,s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=kn(o,r,!0,t)&&s}if(o=t.g=e,s=kn(o,r,!0,t)&&s,s=kn(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)o=t.g=n[i],s=kn(o,r,!1,t)&&s}D.prototype.N=function(){if(D.$.N.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)zn(n[r]);delete e.g[t],e.h--}}this.J=null};D.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};D.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function kn(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&Br(e.i,o),s=a.call(l,r)!==!1&&s}}return s&&!r.defaultPrevented}var ls=p.JSON.stringify,$r=class{constructor(t,n){this.i=t,this.j=n,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function mu(){var e=cs;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var zr=class{constructor(){this.h=this.g=null}add(t,n){let r=Ho.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r}},Ho=new $r(()=>new Kr,e=>e.reset()),Kr=class{constructor(){this.next=this.g=this.h=null}set(t,n){this.h=t,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function pu(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function gu(e){p.setTimeout(()=>{throw e},0)}var Et,It=!1,cs=new zr,Yo=()=>{let e=p.Promise.resolve(void 0);Et=()=>{e.then(_u)}},_u=()=>{for(var e;e=mu();){try{e.h.call(e.g)}catch(n){gu(n)}var t=Ho;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}It=!1};function jn(e,t){D.call(this),this.h=e||1,this.g=t||p,this.j=q(this.qb,this),this.l=Date.now()}k(jn,D);m=jn.prototype;m.ga=!1;m.T=null;m.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),O(this,"tick"),this.ga&&(us(this),this.start()))}};m.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function us(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}m.N=function(){jn.$.N.call(this),us(this),delete this.g};function hs(e,t,n){if(typeof e=="function")n&&(e=q(e,n));else if(e&&typeof e.handleEvent=="function")e=q(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:p.setTimeout(e,t||0)}function Xo(e){e.g=hs(()=>{e.g=null,e.i&&(e.i=!1,Xo(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}var jr=class extends we{constructor(t,n){super(),this.m=t,this.j=n,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Xo(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Tt(e){we.call(this),this.h=e,this.g={}}k(Tt,we);var Po=[];function Jo(e,t,n,r){Array.isArray(n)||(n&&(Po[0]=n.toString()),n=Po);for(var s=0;s<n.length;s++){var i=zo(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Zo(e){rs(e.g,function(t,n){this.g.hasOwnProperty(n)&&is(t)},e),e.g={}}Tt.prototype.N=function(){Tt.$.N.call(this),Zo(this)};Tt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Wn(){this.g=!0}Wn.prototype.Ea=function(){this.g=!1};function yu(e,t,n,r,s,i){e.info(function(){if(e.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+`
`+n+`
`+o})}function vu(e,t,n,r,s,i,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+`
`+n+`
`+i+" "+o})}function Ge(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+Eu(e,n)+(r?" "+r:"")})}function wu(e,t){e.info(function(){return"TIMEOUT: "+t})}Wn.prototype.info=function(){};function Eu(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return ls(n)}catch{return t}}var xe={},bo=null;function Qn(){return bo=bo||new D}xe.Ta="serverreachability";function ea(e){U.call(this,xe.Ta,e)}k(ea,U);function Ct(e){let t=Qn();O(t,new ea(t))}xe.STAT_EVENT="statevent";function ta(e,t){U.call(this,xe.STAT_EVENT,e),this.stat=t}k(ta,U);function z(e){let t=Qn();O(t,new ta(t,e))}xe.Ua="timingevent";function na(e,t){U.call(this,xe.Ua,e),this.size=t}k(na,U);function bt(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}var Hn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ra={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ds(){}ds.prototype.h=null;function xo(e){return e.h||(e.h=e.i())}function sa(){}var xt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function fs(){U.call(this,"d")}k(fs,U);function ms(){U.call(this,"c")}k(ms,U);var Wr;function Yn(){}k(Yn,ds);Yn.prototype.g=function(){return new XMLHttpRequest};Yn.prototype.i=function(){return{}};Wr=new Yn;function Nt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Tt(this),this.P=Iu,e=Lr?125:void 0,this.V=new jn(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ia}function ia(){this.i=null,this.g="",this.h=!1}var Iu=45e3,oa={},Qr={};m=Nt.prototype;m.setTimeout=function(e){this.P=e};function Hr(e,t,n){e.L=1,e.A=Jn(ge(t)),e.u=n,e.S=!0,aa(e,null)}function aa(e,t){e.G=Date.now(),Dt(e),e.B=ge(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),pa(n.i,"t",r),e.o=0,n=e.l.J,e.h=new ia,e.g=Ma(e.l,n?t:null,!e.u),0<e.O&&(e.M=new jr(q(e.Pa,e,e.g),e.O)),Jo(e.U,e.g,"readystatechange",e.nb),t=e.I?Go(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),Ct(),yu(e.j,e.v,e.B,e.m,e.W,e.u)}m.nb=function(e){e=e.target;let t=this.M;t&&he(e)==3?t.l():this.Pa(e)};m.Pa=function(e){try{if(e==this.g)e:{let u=he(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||Lr||this.g&&(this.h.h||this.g.ja()||Vo(this.g)))){this.J||u!=4||t==7||(t==8||0>=h?Ct(3):Ct(2)),Xn(this);var n=this.g.da();this.ca=n;t:if(la(this)){var r=Vo(this.g);e="";var s=r.length,i=he(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Re(this),yt(this);var o="";break t}this.h.i=new p.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,vu(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!vt(a)){var c=a;break t}}c=null}if(n=c)Ge(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Yr(this,n);else{this.i=!1,this.s=3,z(12),Re(this),yt(this);break e}}this.S?(ca(this,u,o),Lr&&this.i&&u==3&&(Jo(this.U,this.V,"tick",this.mb),this.V.start())):(Ge(this.j,this.m,o,null),Yr(this,o)),u==4&&Re(this),this.i&&!this.J&&(u==4?Da(this.l,this):(this.i=!1,Dt(this)))}else $u(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,z(12)):(this.s=0,z(13)),Re(this),yt(this)}}}catch{}finally{}};function la(e){return e.g?e.v=="GET"&&e.L!=2&&e.l.Ha:!1}function ca(e,t,n){let r=!0,s;for(;!e.J&&e.o<n.length;)if(s=Tu(e,n),s==Qr){t==4&&(e.s=4,z(14),r=!1),Ge(e.j,e.m,null,"[Incomplete Response]");break}else if(s==oa){e.s=4,z(15),Ge(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else Ge(e.j,e.m,s,null),Yr(e,s);la(e)&&e.o!=0&&(e.h.g=e.h.g.slice(e.o),e.o=0),t!=4||n.length!=0||e.h.h||(e.s=1,z(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,t=e.l,t.g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ws(t),t.M=!0,z(11))):(Ge(e.j,e.m,n,"[Invalid Chunked Response]"),Re(e),yt(e))}m.mb=function(){if(this.g){var e=he(this.g),t=this.g.ja();this.o<t.length&&(Xn(this),ca(this,e,t),this.i&&e!=4&&Dt(this))}};function Tu(e,t){var n=e.o,r=t.indexOf(`
`,n);return r==-1?Qr:(n=Number(t.substring(n,r)),isNaN(n)?oa:(r+=1,r+n>t.length?Qr:(t=t.slice(r,r+n),e.o=r+n,t)))}m.cancel=function(){this.J=!0,Re(this)};function Dt(e){e.Y=Date.now()+e.P,ua(e,e.P)}function ua(e,t){if(e.C!=null)throw Error("WatchDog timer not null");e.C=bt(q(e.lb,e),t)}function Xn(e){e.C&&(p.clearTimeout(e.C),e.C=null)}m.lb=function(){this.C=null;let e=Date.now();0<=e-this.Y?(wu(this.j,this.B),this.L!=2&&(Ct(),z(17)),Re(this),this.s=2,yt(this)):ua(this,this.Y-e)};function yt(e){e.l.H==0||e.J||Da(e.l,e)}function Re(e){Xn(e);var t=e.M;t&&typeof t.sa=="function"&&t.sa(),e.M=null,us(e.V),Zo(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Yr(e,t){try{var n=e.l;if(n.H!=0&&(n.g==e||Xr(n.i,e))){if(!e.K&&Xr(n.i,e)&&n.H==3){try{var r=n.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)Ln(n),tr(n);else break e;vs(n),z(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&n.A==0&&!n.v&&(n.v=bt(q(n.ib,n),6e3));if(1>=ya(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Pe(n,11)}else if((e.K||n.g==e)&&Ln(n),!vt(t))for(s=n.Ja.g.parse(t),t=0;t<s.length;t++){let c=s[t];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];let u=c[3];u!=null&&(n.ra=u,n.l.info("VER="+n.ra));let h=c[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let g=e.g;if(g){let _=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_){var i=r.i;i.g||_.indexOf("spdy")==-1&&_.indexOf("quic")==-1&&_.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(ps(i,i.h),i.h=null))}if(r.F){let b=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;b&&(r.Da=b,S(r.I,r.F,b))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=e;if(r.wa=Fa(r,r.J?r.pa:null,r.Y),o.K){va(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(Xn(a),Dt(a)),r.g=o}else xa(r);0<n.j.length&&nr(n)}else c[0]!="stop"&&c[0]!="close"||Pe(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Pe(n,7):ys(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}Ct(4)}catch{}}function Cu(e){if(e.Z&&typeof e.Z=="function")return e.Z();if(typeof Map<"u"&&e instanceof Map||typeof Set<"u"&&e instanceof Set)return Array.from(e.values());if(typeof e=="string")return e.split("");if(Gn(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Su(e){if(e.ta&&typeof e.ta=="function")return e.ta();if(!e.Z||typeof e.Z!="function"){if(typeof Map<"u"&&e instanceof Map)return Array.from(e.keys());if(!(typeof Set<"u"&&e instanceof Set)){if(Gn(e)||typeof e=="string"){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(let r in e)t[n++]=r;return t}}}function ha(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(Gn(e)||typeof e=="string")Array.prototype.forEach.call(e,t,void 0);else for(var n=Su(e),r=Cu(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}var da=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Au(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function be(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof be){this.h=e.h,Mn(this,e.j),this.s=e.s,this.g=e.g,On(this,e.m),this.l=e.l;var t=e.i,n=new St;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),No(this,n),this.o=e.o}else e&&(t=String(e).match(da))?(this.h=!1,Mn(this,t[1]||"",!0),this.s=gt(t[2]||""),this.g=gt(t[3]||"",!0),On(this,t[4]),this.l=gt(t[5]||"",!0),No(this,t[6]||"",!0),this.o=gt(t[7]||"")):(this.h=!1,this.i=new St(null,this.h))}be.prototype.toString=function(){var e=[],t=this.j;t&&e.push(_t(t,Do,!0),":");var n=this.g;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(_t(t,Do,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&e.push("/"),e.push(_t(n,n.charAt(0)=="/"?bu:Pu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",_t(n,Nu)),e.join("")};function ge(e){return new be(e)}function Mn(e,t,n){e.j=n?gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function On(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function No(e,t,n){t instanceof St?(e.i=t,Du(e.i,e.h)):(n||(t=_t(t,xu)),e.i=new St(t,e.h))}function S(e,t,n){e.i.set(t,n)}function Jn(e){return S(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function _t(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Ru),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ru(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var Do=/[#\/\?@]/g,Pu=/[#\?:]/g,bu=/[#\?]/g,xu=/[#\?@]/g,Nu=/#/g;function St(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ee(e){e.g||(e.g=new Map,e.h=0,e.i&&Au(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}m=St.prototype;m.add=function(e,t){Ee(this),this.i=null,e=Ke(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function fa(e,t){Ee(e),t=Ke(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ma(e,t){return Ee(e),t=Ke(e,t),e.g.has(t)}m.forEach=function(e,t){Ee(this),this.g.forEach(function(n,r){n.forEach(function(s){e.call(t,s,r,this)},this)},this)};m.ta=function(){Ee(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let s=e[r];for(let i=0;i<s.length;i++)n.push(t[r])}return n};m.Z=function(e){Ee(this);let t=[];if(typeof e=="string")ma(this,e)&&(t=t.concat(this.g.get(Ke(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t};m.set=function(e,t){return Ee(this),this.i=null,e=Ke(this,e),ma(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};m.get=function(e,t){return e?(e=this.Z(e),0<e.length?String(e[0]):t):t};function pa(e,t,n){fa(e,t),0<n.length&&(e.i=null,e.g.set(Ke(e,t),ts(n)),e.h+=n.length)}m.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;o[r]!==""&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")};function Ke(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Du(e,t){t&&!e.j&&(Ee(e),e.i=null,e.g.forEach(function(n,r){var s=r.toLowerCase();r!=s&&(fa(this,r),pa(this,s,n))},e)),e.j=t}var ku=class{constructor(e,t){this.g=e,this.map=t}};function ga(e){this.l=e||Vu,p.PerformanceNavigationTiming?(e=p.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(p.g&&p.g.Ka&&p.g.Ka()&&p.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Vu=10;function _a(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function ya(e){return e.h?1:e.g?e.g.size:0}function Xr(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function ps(e,t){e.g?e.g.add(t):e.h=t}function va(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}ga.prototype.cancel=function(){if(this.i=wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function wa(e){if(e.h!=null)return e.i.concat(e.h.F);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return ts(e.i)}var Fu=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function Mu(){this.g=new Fu}function Ou(e,t,n){let r=n||"";try{ha(e,function(s,i){let o=s;Rt(s)&&(o=ls(s)),t.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw t.push(r+"type="+encodeURIComponent("_badmap")),s}}function Lu(e,t){let n=new Wn;if(p.Image){let r=new Image;r.onload=bn(Vn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=bn(Vn,n,r,"TestLoadImage: error",!1,t),r.onabort=bn(Vn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=bn(Vn,n,r,"TestLoadImage: timeout",!1,t),p.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function Vn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch{}}function kt(e){this.l=e.ec||null,this.j=e.ob||!1}k(kt,ds);kt.prototype.g=function(){return new Zn(this.l,this.j)};kt.prototype.i=function(e){return function(){return e}}({});function Zn(e,t){D.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=gs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}k(Zn,D);var gs=0;m=Zn.prototype;m.open=function(e,t){if(this.readyState!=gs)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,At(this)};m.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||p).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};m.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Vt(this)),this.readyState=gs};m.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,At(this)),this.g&&(this.readyState=3,At(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof p.ReadableStream<"u"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ea(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))};function Ea(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}m.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Vt(this):At(this),this.readyState==3&&Ea(this)}};m.Za=function(e){this.g&&(this.response=this.responseText=e,Vt(this))};m.Ya=function(e){this.g&&(this.response=e,Vt(this))};m.ka=function(){this.g&&Vt(this)};function Vt(e){e.readyState=4,e.l=null,e.j=null,e.A=null,At(e)}m.setRequestHeader=function(e,t){this.v.append(e,t)};m.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};m.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function At(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Zn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var qu=p.JSON.parse;function P(e){D.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Ia,this.L=this.M=!1}k(P,D);var Ia="",Uu=/^https?$/i,Bu=["POST","PUT"];m=P.prototype;m.Oa=function(e){this.M=e};m.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Wr.g(),this.C=this.u?xo(this.u):xo(Wr),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(i){ko(this,i);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let i of r.keys())n.set(i,r.get(i));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(i=>i.toLowerCase()=="content-type"),s=p.FormData&&e instanceof p.FormData,!(0<=Lo(Bu,t))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[i,o]of n)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Sa(this),0<this.B&&((this.L=Gu(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=hs(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(i){ko(this,i)}};function Gu(e){return ze&&typeof e.timeout=="number"&&e.ontimeout!==void 0}m.ua=function(){typeof es<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,O(this,"timeout"),this.abort(8))};function ko(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Ta(e),er(e)}function Ta(e){e.F||(e.F=!0,O(e,"complete"),O(e,"error"))}m.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,O(this,"complete"),O(this,"abort"),er(this))};m.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),er(this,!0)),P.$.N.call(this)};m.La=function(){this.s||(this.G||this.v||this.l?Ca(this):this.kb())};m.kb=function(){Ca(this)};function Ca(e){if(e.h&&typeof es<"u"&&(!e.C[1]||he(e)!=4||e.da()!=2)){if(e.v&&he(e)==4)hs(e.La,0,e);else if(O(e,"readystatechange"),he(e)==4){e.h=!1;try{let o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=o===0){var s=String(e.I).match(da)[1]||null;!s&&p.self&&p.self.location&&(s=p.self.location.protocol.slice(0,-1)),r=!Uu.test(s?s.toLowerCase():"")}n=r}if(n)O(e,"complete"),O(e,"success");else{e.m=6;try{var i=2<he(e)?e.g.statusText:""}catch{i=""}e.j=i+" ["+e.da()+"]",Ta(e)}}finally{er(e)}}}}function er(e,t){if(e.g){Sa(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||O(e,"ready");try{n.onreadystatechange=r}catch{}}}function Sa(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(p.clearTimeout(e.A),e.A=null)}m.isActive=function(){return!!this.g};function he(e){return e.g?e.g.readyState:0}m.da=function(){try{return 2<he(this)?this.g.status:-1}catch{return-1}};m.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};m.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),qu(t)}};function Vo(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Ia:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function $u(e){let t={};e=(e.g&&2<=he(e)&&e.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<e.length;r++){if(vt(e[r]))continue;var n=pu(e[r]);let s=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let i=t[s]||[];t[s]=i,i.push(n)}hu(t,function(r){return r.join(", ")})}m.Ia=function(){return this.m};m.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Aa(e){let t="";return rs(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function _s(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Aa(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):S(e,t,n))}function mt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ra(e){this.Ga=0,this.j=[],this.l=new Wn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=mt("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=mt("baseRetryDelayMs",5e3,e),this.hb=mt("retryDelaySeedMs",1e4,e),this.eb=mt("forwardChannelMaxRetries",2,e),this.xa=mt("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new ga(e&&e.concurrentRequestLimit),this.Ja=new Mu,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}m=Ra.prototype;m.ra=8;m.H=1;function ys(e){if(Pa(e),e.H==3){var t=e.W++,n=ge(e.I);if(S(n,"SID",e.K),S(n,"RID",t),S(n,"TYPE","terminate"),Ft(e,n),t=new Nt(e,e.l,t),t.L=2,t.A=Jn(ge(n)),n=!1,p.navigator&&p.navigator.sendBeacon)try{n=p.navigator.sendBeacon(t.A.toString(),"")}catch{}!n&&p.Image&&(new Image().src=t.A,n=!0),n||(t.g=Ma(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Dt(t)}Va(e)}function tr(e){e.g&&(ws(e),e.g.cancel(),e.g=null)}function Pa(e){tr(e),e.u&&(p.clearTimeout(e.u),e.u=null),Ln(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&p.clearTimeout(e.m),e.m=null)}function nr(e){if(!_a(e.i)&&!e.m){e.m=!0;var t=e.Na;Et||Yo(),It||(Et(),It=!0),cs.add(t,e),e.C=0}}function zu(e,t){return ya(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.j=t.F.concat(e.j),!0):e.H==1||e.H==2||e.C>=(e.cb?0:e.eb)?!1:(e.m=bt(q(e.Na,e,t),ka(e,e.C)),e.C++,!0)}m.Na=function(e){if(this.m)if(this.m=null,this.H==1){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let s=new Nt(this,this.l,e),i=this.s;if(this.U&&(i?(i=Go(i),$o(i,this.U)):i=this.U),this.o!==null||this.O||(s.I=i,i=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=n;break e}if(t===4096||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ba(this,s,t),n=ge(this.I),S(n,"RID",e),S(n,"CVER",22),this.F&&S(n,"X-HTTP-Session-Id",this.F),Ft(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Aa(i)))+"&"+t:this.o&&_s(n,this.o,i)),ps(this.i,s),this.bb&&S(n,"TYPE","init"),this.P?(S(n,"$req",t),S(n,"SID","null"),s.aa=!0,Hr(s,n,null)):Hr(s,n,t),this.H=2}}else this.H==3&&(e?Fo(this,e):this.j.length==0||_a(this.i)||Fo(this))};function Fo(e,t){var n;t?n=t.m:n=e.W++;let r=ge(e.I);S(r,"SID",e.K),S(r,"RID",n),S(r,"AID",e.V),Ft(e,r),e.o&&e.s&&_s(r,e.o,e.s),n=new Nt(e,e.l,n,e.C+1),e.o===null&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=ba(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),ps(e.i,n),Hr(n,r,t)}function Ft(e,t){e.na&&rs(e.na,function(n,r){S(t,r,n)}),e.h&&ha({},function(n,r){S(t,r,n)})}function ba(e,t,n){n=Math.min(e.j.length,n);var r=e.h?q(e.h.Va,e.h,e):null;e:{var s=e.j;let i=-1;for(;;){let o=["count="+n];i==-1?0<n?(i=s[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<n;l++){let c=s[l].g,u=s[l].map;if(c-=i,0>c)i=Math.max(0,s[l].g-100),a=!1;else try{Ou(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function xa(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Et||Yo(),It||(Et(),It=!0),cs.add(t,e),e.A=0}}function vs(e){return e.g||e.u||3<=e.A?!1:(e.ba++,e.u=bt(q(e.Ma,e),ka(e,e.A)),e.A++,!0)}m.Ma=function(){if(this.u=null,Na(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=bt(q(this.jb,this),e)}};m.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,z(10),tr(this),Na(this))};function ws(e){e.B!=null&&(p.clearTimeout(e.B),e.B=null)}function Na(e){e.g=new Nt(e,e.l,"rpc",e.ba),e.o===null&&(e.g.I=e.s),e.g.O=0;var t=ge(e.wa);S(t,"RID","rpc"),S(t,"SID",e.K),S(t,"AID",e.V),S(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&S(t,"TO",e.qa),S(t,"TYPE","xmlhttp"),Ft(e,t),e.o&&e.s&&_s(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Jn(ge(t)),n.u=null,n.S=!0,aa(n,e)}m.ib=function(){this.v!=null&&(this.v=null,tr(this),vs(this),z(19))};function Ln(e){e.v!=null&&(p.clearTimeout(e.v),e.v=null)}function Da(e,t){var n=null;if(e.g==t){Ln(e),ws(e),e.g=null;var r=2}else if(Xr(e.i,t))n=t.F,va(e.i,t),r=1;else return;if(e.H!=0){if(t.i)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.G;var s=e.C;r=Qn(),O(r,new na(r,n)),nr(e)}else xa(e);else if(s=t.s,s==3||s==0&&0<t.ca||!(r==1&&zu(e,t)||r==2&&vs(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:Pe(e,5);break;case 4:Pe(e,10);break;case 3:Pe(e,6);break;default:Pe(e,2)}}}function ka(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Pe(e,t){if(e.l.info("Error code "+t),t==2){var n=null;e.h&&(n=null);var r=q(e.pb,e);n||(n=new be("//www.google.com/images/cleardot.gif"),p.location&&p.location.protocol=="http"||Mn(n,"https"),Jn(n)),Lu(n.toString(),r)}else z(2);e.H=0,e.h&&e.h.za(t),Va(e),Pa(e)}m.pb=function(e){e?(this.l.info("Successfully pinged google.com"),z(2)):(this.l.info("Failed to ping google.com"),z(1))};function Va(e){if(e.H=0,e.ma=[],e.h){let t=wa(e.i);(t.length!=0||e.j.length!=0)&&(Ao(e.ma,t),Ao(e.ma,e.j),e.i.i.length=0,ts(e.j),e.j.length=0),e.h.ya()}}function Fa(e,t,n){var r=n instanceof be?ge(n):new be(n);if(r.g!="")t&&(r.g=t+"."+r.g),On(r,r.m);else{var s=p.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var i=new be(null);r&&Mn(i,r),t&&(i.g=t),s&&On(i,s),n&&(i.l=n),r=i}return n=e.F,t=e.Da,n&&t&&S(r,n,t),S(r,"VER",e.ra),Ft(e,r),r}function Ma(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=e.Ha&&!e.va?new P(new kt({ob:n})):new P(e.va),t.Oa(e.J),t}m.isActive=function(){return!!this.h&&this.h.isActive(this)};function Oa(){}m=Oa.prototype;m.Ba=function(){};m.Aa=function(){};m.za=function(){};m.ya=function(){};m.isActive=function(){return!0};m.Va=function(){};function qn(){if(ze&&!(10<=Number(au)))throw Error("Environmental error: no available transport.")}qn.prototype.g=function(e,t){return new W(e,t)};function W(e,t){D.call(this),this.g=new Ra(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!vt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!vt(t)&&(this.g.F=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new je(this)}k(W,D);W.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;z(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Fa(e,null,e.Y),nr(e)};W.prototype.close=function(){ys(this.g)};W.prototype.u=function(e){var t=this.g;if(typeof e=="string"){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=ls(e),e=n);t.j.push(new ku(t.fb++,e)),t.H==3&&nr(t)};W.prototype.N=function(){this.g.h=null,delete this.j,ys(this.g),delete this.g,W.$.N.call(this)};function La(e){fs.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}k(La,fs);function qa(){ms.call(this),this.status=1}k(qa,ms);function je(e){this.g=e}k(je,Oa);je.prototype.Ba=function(){O(this.g,"a")};je.prototype.Aa=function(e){O(this.g,new La(e))};je.prototype.za=function(e){O(this.g,new qa)};je.prototype.ya=function(){O(this.g,"b")};function Ku(){this.blockSize=-1}function te(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}k(te,Ku);te.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Or(e,t,n){n||(n=0);var r=Array(16);if(typeof t=="string")for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[1]+3905402710&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[2]+606105819&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[3]+3250441966&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[5]+1200080426&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[6]+2821735955&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[7]+4249261313&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[9]+2336552879&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[10]+4294925233&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[11]+2304563134&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[13]+4254626195&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[14]+2792965006&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[15]+1236535329&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(s^i&(n^s))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[6]+3225465664&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[11]+643717713&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[0]+3921069994&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[10]+38016083&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[15]+3634488961&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[4]+3889429448&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[14]+3275163606&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[3]+4107603335&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[8]+1163531501&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[2]+4243563512&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[7]+1735328473&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[12]+2368359562&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(n^s^i)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[8]+2272392833&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[11]+1839030562&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[14]+4259657740&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[4]+1272893353&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[7]+4139469664&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[10]+3200236656&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[0]+3936430074&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[3]+3572445317&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[6]+76029189&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[12]+3873151461&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[15]+530742520&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[2]+3299628645&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(s^(n|~i))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[7]+1126891415&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[14]+2878612391&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[5]+4237533241&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[3]+2399980690&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[10]+4293915773&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[1]+2240044497&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[15]+4264355552&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[6]+2734768916&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[13]+1309151649&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[11]+3174756917&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[2]+718787259&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}te.prototype.j=function(e,t){t===void 0&&(t=e.length);for(var n=t-this.blockSize,r=this.m,s=this.h,i=0;i<t;){if(s==0)for(;i<=n;)Or(this,e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[s++]=e.charCodeAt(i++),s==this.blockSize){Or(this,r),s=0;break}}else for(;i<t;)if(r[s++]=e[i++],s==this.blockSize){Or(this,r),s=0;break}}this.h=s,this.i+=t};te.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=n&255,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};function I(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=e[s]|0;r&&i==t||(n[s]=i,r=!1)}this.g=n}var ju={};function Es(e){return-128<=e&&128>e?su(e,function(t){return new I([t|0],0>t?-1:0)}):new I([e|0],0>e?-1:0)}function de(e){if(isNaN(e)||!isFinite(e))return $e;if(0>e)return M(de(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Jr;return new I(t,0)}function Ua(e,t){if(e.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(e.charAt(0)=="-")return M(Ua(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=de(Math.pow(t,8)),r=$e,s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s),o=parseInt(e.substring(s,s+i),t);8>i?(i=de(Math.pow(t,i)),r=r.R(i).add(de(o))):(r=r.R(n),r=r.add(de(o)))}return r}var Jr=4294967296,$e=Es(0),Zr=Es(1),Mo=Es(16777216);m=I.prototype;m.ea=function(){if(X(this))return-M(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Jr+r)*t,t*=Jr}return e};m.toString=function(e){if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(pe(this))return"0";if(X(this))return"-"+M(this).toString(e);for(var t=de(Math.pow(e,6)),n=this,r="";;){var s=Bn(n,t).g;n=Un(n,s.R(t));var i=((0<n.g.length?n.g[0]:n.h)>>>0).toString(e);if(n=s,pe(n))return i+r;for(;6>i.length;)i="0"+i;r=i+r}};m.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h};function pe(e){if(e.h!=0)return!1;for(var t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function X(e){return e.h==-1}m.X=function(e){return e=Un(this,e),X(e)?-1:pe(e)?0:1};function M(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new I(n,~e.h).add(Zr)}m.abs=function(){return X(this)?M(this):this};m.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var i=r+(this.D(s)&65535)+(e.D(s)&65535),o=(i>>>16)+(this.D(s)>>>16)+(e.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new I(n,n[n.length-1]&-2147483648?-1:0)};function Un(e,t){return e.add(M(t))}m.R=function(e){if(pe(this)||pe(e))return $e;if(X(this))return X(e)?M(this).R(M(e)):M(M(this).R(e));if(X(e))return M(this.R(M(e)));if(0>this.X(Mo)&&0>e.X(Mo))return de(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var i=this.D(r)>>>16,o=this.D(r)&65535,a=e.D(s)>>>16,l=e.D(s)&65535;n[2*r+2*s]+=o*l,Fn(n,2*r+2*s),n[2*r+2*s+1]+=i*l,Fn(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,Fn(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,Fn(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new I(n,0)};function Fn(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function pt(e,t){this.g=e,this.h=t}function Bn(e,t){if(pe(t))throw Error("division by zero");if(pe(e))return new pt($e,$e);if(X(e))return t=Bn(M(e),t),new pt(M(t.g),M(t.h));if(X(t))return t=Bn(e,M(t)),new pt(M(t.g),t.h);if(30<e.g.length){if(X(e)||X(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Zr,r=t;0>=r.X(e);)n=Oo(n),r=Oo(r);var s=Be(n,1),i=Be(r,1);for(r=Be(r,2),n=Be(n,2);!pe(r);){var o=i.add(r);0>=o.X(e)&&(s=s.add(n),i=o),r=Be(r,1),n=Be(n,1)}return t=Un(e,s.R(t)),new pt(s,t)}for(s=$e;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),i=de(n),o=i.R(t);X(o)||0<o.X(e);)n-=r,i=de(n),o=i.R(t);pe(i)&&(i=Zr),s=s.add(i),e=Un(e,o)}return new pt(s,e)}m.gb=function(e){return Bn(this,e).h};m.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new I(n,this.h&e.h)};m.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new I(n,this.h|e.h)};m.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new I(n,this.h^e.h)};function Oo(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new I(n,e.h)}function Be(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],i=0;i<r;i++)s[i]=0<t?e.D(i+n)>>>t|e.D(i+n+1)<<32-t:e.D(i+n);return new I(s,e.h)}qn.prototype.createWebChannel=qn.prototype.g;W.prototype.send=W.prototype.u;W.prototype.open=W.prototype.m;W.prototype.close=W.prototype.close;Hn.NO_ERROR=0;Hn.TIMEOUT=8;Hn.HTTP_ERROR=6;ra.COMPLETE="complete";sa.EventType=xt;xt.OPEN="a";xt.CLOSE="b";xt.ERROR="c";xt.MESSAGE="d";D.prototype.listen=D.prototype.O;P.prototype.listenOnce=P.prototype.P;P.prototype.getLastError=P.prototype.Sa;P.prototype.getLastErrorCode=P.prototype.Ia;P.prototype.getStatus=P.prototype.da;P.prototype.getResponseJson=P.prototype.Wa;P.prototype.getResponseText=P.prototype.ja;P.prototype.send=P.prototype.ha;P.prototype.setWithCredentials=P.prototype.Oa;te.prototype.digest=te.prototype.l;te.prototype.reset=te.prototype.reset;te.prototype.update=te.prototype.j;I.prototype.add=I.prototype.add;I.prototype.multiply=I.prototype.R;I.prototype.modulo=I.prototype.gb;I.prototype.compare=I.prototype.X;I.prototype.toNumber=I.prototype.ea;I.prototype.toString=I.prototype.toString;I.prototype.getBits=I.prototype.D;I.fromNumber=de;I.fromString=Ua;var Wu=ne.createWebChannelTransport=function(){return new qn},Qu=ne.getStatEventTarget=function(){return Qn()},Hu=ne.ErrorCode=Hn,Yu=ne.EventType=ra,Xu=ne.Event=xe,Ju=ne.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Zu=ne.FetchXmlHttpFactory=kt,eh=ne.WebChannel=sa,th=ne.XhrIo=P,nh=ne.Md5=te,Ba=ne.Integer=I;var Ga="@firebase/firestore";var V=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};V.UNAUTHENTICATED=new V(null),V.GOOGLE_CREDENTIALS=new V("google-credentials-uid"),V.FIRST_PARTY=new V("first-party-uid"),V.MOCK_USER=new V("mock-user");var Ot="10.11.1";var Qe=new pn("@firebase/firestore");function Q(e,...t){if(Qe.logLevel<=Ue.DEBUG){let n=t.map(Gs);Qe.debug(`Firestore (${Ot}): ${e}`,...n)}}function Bs(e,...t){if(Qe.logLevel<=Ue.ERROR){let n=t.map(Gs);Qe.error(`Firestore (${Ot}): ${e}`,...n)}}function rh(e,...t){if(Qe.logLevel<=Ue.WARN){let n=t.map(Gs);Qe.warn(`Firestore (${Ot}): ${e}`,...n)}}function Gs(e){if(typeof e=="string")return e;try{return function(n){return JSON.stringify(n)}(e)}catch{return e}}function K(e="Unexpected state"){let t=`FIRESTORE (${Ot}) INTERNAL ASSERTION FAILED: `+e;throw Bs(t),new Error(t)}function Mt(e,t){e||K()}var L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends mo{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Te=class{constructor(){this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}};var rr=class{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Ts=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable(()=>n(V.UNAUTHENTICATED))}shutdown(){}},Cs=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,n){this.changeListener=n,t.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Ss=class{constructor(t){this.t=t,this.currentUser=V.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i,s=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve(),i=new Te;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Te,t.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let l=i;t.enqueueRetryable(()=>ve(this,null,function*(){yield l.promise,yield s(this.currentUser)}))},a=l=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Te)}},0),o()}getToken(){let t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==t?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Mt(typeof r.accessToken=="string"),new rr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return Mt(t===null||typeof t=="string"),new V(t)}},As=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=V.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Rs=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r}getToken(){return Promise.resolve(new As(this.l,this.h,this.P))}start(t,n){t.enqueueRetryable(()=>n(V.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ps=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},bs=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,n){let r=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let o=i.token!==this.R;return this.R=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>r(i))};let s=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.A.getImmediate({optional:!0});i?s(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(n=>n?(Mt(typeof n.token=="string"),this.R=n.token,new Ps(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function sh(e){let t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var xs=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let s=sh(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=t.charAt(s[i]%t.length))}return r}};function Wa(e,t){return e<t?-1:e>t?1:0}var Ns=class e{constructor(t,n,r){n===void 0?n=0:n>t.length&&K(),r===void 0?r=t.length-n:r>t.length-n&&K(),this.segments=t,this.offset=n,this.len=r}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(r=>{n.push(r)}):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let s=0;s<r;s++){let i=t.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return t.length<n.length?-1:t.length>n.length?1:0}},Ie=class e extends Ns{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let n=[];for(let r of t){if(r.indexOf("//")>=0)throw new x(L.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new e(n)}static emptyPath(){return new e([])}};var Ne=class e{constructor(t){this.path=t}static fromPath(t){return new e(Ie.fromString(t))}static fromName(t){return new e(Ie.fromString(t).popFirst(5))}static empty(){return new e(Ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ie.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return Ie.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new e(new Ie(t.slice()))}};var Ds=class{constructor(t,n,r,s){this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=s}};Ds.UNKNOWN_ID=-1;function Qa(e){return e.name==="IndexedDbTransactionError"}function ih(e){return e===0&&1/e==-1/0}var oh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],am=[...oh,"documentOverlays"],ah=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lh=ah,lm=[...lh,"indexConfiguration","indexState","indexEntries"];var He=class e{constructor(t,n){this.comparator=t,this.root=n||me.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,me.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,me.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(t){let n=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((n,r)=>(t(n,r),!1))}toString(){let t=[];return this.inorderTraversal((n,r)=>(t.push(`${n}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new We(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new We(this.root,t,this.comparator,!1)}getReverseIterator(){return new We(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new We(this.root,t,this.comparator,!0)}},We=class{constructor(t,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=n?r(t.key,n):1,n&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},me=class e{constructor(t,n,r,s,i){this.key=t,this.value=n,this.color=r??e.RED,this.left=s??e.EMPTY,this.right=i??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,s,i){return new e(t??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let s=this,i=r(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(t,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,s=this;if(n(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(t,s.key)===0){if(s.right.isEmpty())return e.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw K();let t=this.left.check();if(t!==this.right.check())throw K();return t+(this.isRed()?0:1)}};me.EMPTY=null,me.RED=!0,me.BLACK=!1;me.EMPTY=new class{constructor(){this.size=0}get key(){throw K()}get value(){throw K()}get color(){throw K()}get left(){throw K()}get right(){throw K()}copy(t,n,r,s,i){return this}insert(t,n,r){return new me(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var sr=class e{constructor(t){this.comparator=t,this.data=new He(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((n,r)=>(t(n),!1))}forEachInRange(t,n){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;n(s.key)}}forEachWhile(t,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new ir(this.data.getIterator())}getIteratorFrom(t){return new ir(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach(r=>{n=n.add(r)}),n}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(n=>{t.push(n)}),t}toString(){let t=[];return this.forEach(n=>t.push(n)),"SortedSet("+t.toString()+")"}copy(t){let n=new e(this.comparator);return n.data=t,n}},ir=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var ks=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ye=class e{constructor(t){this.binaryString=t}static fromBase64String(t){let n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ks("Invalid base64 string: "+i):i}}(t);return new e(n)}static fromUint8Array(t){let n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(t);return new e(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Wa(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Ye.EMPTY_BYTE_STRING=new Ye("");var ch=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function uh(e){if(Mt(!!e),typeof e=="string"){let t=0,n=ch.exec(e);if(Mt(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:or(e.seconds),nanos:or(e.nanos)}}function or(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function hh(e){return typeof e=="string"?Ye.fromBase64String(e):Ye.fromUint8Array(e)}var Vs=class{constructor(t,n,r,s,i,o,a,l,c){this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},Fs=class e{constructor(t,n){this.projectId=t,this.database=n||"(default)"}static empty(){return new e("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}};function dh(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var um=new He(Ne.comparator);var hm=new He(Ne.comparator);var dm=new He(Ne.comparator),fm=new sr(Ne.comparator);var mm=new sr(Wa);var $a,v;(v=$a||($a={}))[v.OK=0]="OK",v[v.CANCELLED=1]="CANCELLED",v[v.UNKNOWN=2]="UNKNOWN",v[v.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",v[v.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",v[v.NOT_FOUND=5]="NOT_FOUND",v[v.ALREADY_EXISTS=6]="ALREADY_EXISTS",v[v.PERMISSION_DENIED=7]="PERMISSION_DENIED",v[v.UNAUTHENTICATED=16]="UNAUTHENTICATED",v[v.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",v[v.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",v[v.ABORTED=10]="ABORTED",v[v.OUT_OF_RANGE=11]="OUT_OF_RANGE",v[v.UNIMPLEMENTED=12]="UNIMPLEMENTED",v[v.INTERNAL=13]="INTERNAL",v[v.UNAVAILABLE=14]="UNAVAILABLE",v[v.DATA_LOSS=15]="DATA_LOSS";var pm=new Ba([4294967295,4294967295],0);var ar=class{constructor(){}ht(t,n){this.Pt(t,n),n.It()}Pt(t,n){if("nullValue"in t)this.Tt(n,5);else if("booleanValue"in t)this.Tt(n,10),n.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(n,15),n.Et(or(t.integerValue));else if("doubleValue"in t){let r=or(t.doubleValue);isNaN(r)?this.Tt(n,13):(this.Tt(n,15),ih(r)?n.Et(0):n.Et(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Tt(n,20),typeof r=="string"&&(r=uh(r)),n.dt(`${r.seconds||""}`),n.Et(r.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,n),this.Rt(n);else if("bytesValue"in t)this.Tt(n,30),n.Vt(hh(t.bytesValue)),this.Rt(n);else if("referenceValue"in t)this.ft(t.referenceValue,n);else if("geoPointValue"in t){let r=t.geoPointValue;this.Tt(n,45),n.Et(r.latitude||0),n.Et(r.longitude||0)}else"mapValue"in t?dh(t)?this.Tt(n,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,n),this.Rt(n)):"arrayValue"in t?(this.yt(t.arrayValue,n),this.Rt(n)):K()}At(t,n){this.Tt(n,25),this.wt(t,n)}wt(t,n){n.dt(t)}gt(t,n){let r=t.fields||{};this.Tt(n,55);for(let s of Object.keys(r))this.At(s,n),this.Pt(r[s],n)}yt(t,n){let r=t.values||[];this.Tt(n,50);for(let s of r)this.Pt(s,n)}ft(t,n){this.Tt(n,37),Ne.fromName(t).path.forEach(r=>{this.Tt(n,60),this.wt(r,n)})}Tt(t,n){t.Et(n)}Rt(t){t.Et(2)}};ar.St=new ar;var gm=new Uint8Array(0);var fe=class e{constructor(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};fe.DEFAULT_COLLECTION_PERCENTILE=10,fe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fe.DEFAULT=new fe(41943040,fe.DEFAULT_COLLECTION_PERCENTILE,fe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fe.DISABLED=new fe(-1,0,0);function Is(){return typeof document<"u"?document:null}var Ms=class{constructor(t,n,r=1e3,s=1.5,i=6e4){this.si=t,this.timerId=n,this.Oo=r,this.No=s,this.Lo=i,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();let n=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),s=Math.max(0,n-r);s>0&&Q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Bo} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,s,()=>(this.qo=Date.now(),t())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var Os=class e{constructor(t,n,r,s,i){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,s,i){let o=Date.now()+r,a=new e(t,n,o,s,i);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(L.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function fh(e,t){if(Bs("AsyncQueue",`${t}: ${e}`),Qa(e))return new x(L.UNAVAILABLE,`${t}: ${e}`);throw e}var za,Ka;(Ka=za||(za={})).J_="default",Ka.Cache="cache";var Ls=class{constructor(t,n,r,s){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=V.UNAUTHENTICATED,this.clientId=xs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,i=>ve(this,null,function*(){Q("FirestoreClient","Received user=",i.uid),yield this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(r,i=>(Q("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(L.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>ve(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){let r=fh(n,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Ha(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var ja=new Map;function mh(e,t,n,r){if(t===!0&&r===!0)throw new x(L.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function ph(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":K()}function gh(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new x(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=ph(e);throw new x(L.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}var lr=class{constructor(t){var n,r;if(t.host===void 0){if(t.ssl!==void 0)throw new x(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}mh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ha((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new x(L.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new x(L.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new x(L.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},cr=class{constructor(t,n,r,s){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lr({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new x(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lr(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ts;switch(r.type){case"firstParty":return new Rs(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=ja.get(n);r&&(Q("ComponentProvider","Removing Datastore"),ja.delete(n),r.terminate())}(this),Promise.resolve()}};function Ya(e,t,n,r={}){var s;let i=(e=gh(e,cr))._getSettings(),o=`${t}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&rh("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=V.MOCK_USER;else{a=hn(r.mockUserToken,(s=e._app)===null||s===void 0?void 0:s.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new x(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new V(c)}e._authCredentials=new Cs(new rr(a,l))}}var qs=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Ms(this,"async_queue_retry"),this.hu=()=>{let n=Is();n&&Q("AsyncQueue","Visibility state changed to "+n.visibilityState),this.Jo.Uo()};let t=Is();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;let n=Is();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise(()=>{});let n=new Te;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.su.push(t),this.Tu()))}Tu(){return ve(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!Qa(t))throw t;Q("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(t){let n=this.iu.then(()=>(this.uu=!0,t().catch(r=>{this.au=r,this.uu=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Bs("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.uu=!1,r))));return this.iu=n,n}enqueueAfterDelay(t,n,r){this.Pu(),this.lu.indexOf(t)>-1&&(n=0);let s=Os.createAndSchedule(this,t,n,r,i=>this.Eu(i));return this._u.push(s),s}Pu(){this.au&&K()}verifyOperationInProgress(){}du(){return ve(this,null,function*(){let t;do t=this.iu,yield t;while(t!==this.iu)})}Au(t){for(let n of this._u)if(n.timerId===t)return!0;return!1}Ru(t){return this.du().then(()=>{this._u.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this._u)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.du()})}Vu(t){this.lu.push(t)}Eu(t){let n=this._u.indexOf(t);this._u.splice(n,1)}};var Us=class extends cr{constructor(t,n,r,s){super(t,n,r,s),this.type="firestore",this._queue=function(){return new qs}(),this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||_h(this),this._firestoreClient.terminate()}};function Xa(e,t){let n=typeof e=="object"?e:vn(),r=typeof e=="string"?e:t||"(default)",s=_n(n,"firestore").getImmediate({identifier:r});if(!s._initialized){let i=un("firestore");i&&Ya(s,...i)}return s}function _h(e){var t,n,r;let s=e._freezeSettings(),i=function(a,l,c,u){return new Vs(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Ha(u.experimentalLongPollingOptions),u.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new Ls(e._authCredentials,e._appCheckCredentials,e._queue,i),!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}var _m=new RegExp("[~\\*/\\[\\]]");(function(t,n=!0){(function(s){Ot=s})(yn),gn(new mn("firestore",(r,{instanceIdentifier:s,options:i})=>{let o=r.getProvider("app").getImmediate(),a=new Us(new Ss(r.getProvider("auth-internal")),new bs(r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new x(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fs(c.options.projectId,u)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ce(Ga,"4.6.1",t),ce(Ga,"4.6.1","esm2017")})();var Lt=class{constructor(t){return t}},Za="firestore",$s=class{constructor(){return In(Za)}};var zs=new on("angularfire2.firestore-instances");function yh(e,t){let n=En(Za,e,t);return n&&new Lt(n)}function vh(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new Lt(r)}}var wh={provide:$s,deps:[[new oe,zs]]},Eh={provide:Lt,useFactory:yh,deps:[[new oe,zs],An]},Ih=(()=>{class e{constructor(){ce("angularfire",wn.full,"fst")}static \u0275fac=function(r){return new(r||e)};static \u0275mod=an({type:e});static \u0275inj=sn({providers:[Eh,wh]})}return e})();function el(e,...t){return{ngModule:Ih,providers:[{provide:zs,useFactory:vh(e),multi:!0,deps:[cn,ln,Cn,Rn,[new oe,Pn],[new oe,Tn],...t]}]}}var tl=Sn(Xa,!0);var nl="@firebase/database",rl="1.0.4";var Gi="";function Th(e){Gi=e}var Js=class{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,n){n==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),N(n))}get(t){let n=this.domStorage_.getItem(this.prefixedName_(t));return n==null?null:dn(n)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}};var Zs=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,n){n==null?delete this.cache_[t]:this.cache_[t]=n}get(t){return le(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}};var Fl=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Js(t)}}catch{}return new Zs},ke=Fl("localStorage"),ei=Fl("sessionStorage");var et=new pn("@firebase/database"),Ch=function(){let e=1;return function(){return e++}}(),Ml=function(e){let t=wo(e),n=new yo;n.update(t);let r=n.digest();return co.encodeByteArray(r)},Xt=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?t+=Xt.apply(null,r):typeof r=="object"?t+=N(r):t+=r,t+=" "}return t},Ve=null,sl=!0,Sh=function(e,t){f(!t||e===!0||e===!1,"Can't turn on custom loggers persistently."),e===!0?(et.logLevel=Ue.VERBOSE,Ve=et.log.bind(et),t&&ei.set("logging_enabled",!0)):typeof e=="function"?Ve=e:(Ve=null,ei.remove("logging_enabled"))},B=function(...e){if(sl===!0&&(sl=!1,Ve===null&&ei.get("logging_enabled")===!0&&Sh(!0)),Ve){let t=Xt.apply(null,e);Ve(t)}},Jt=function(e){return function(...t){B(e,...t)}},ti=function(...e){let t="FIREBASE INTERNAL ERROR: "+Xt(...e);et.error(t)},ye=function(...e){let t=`FIREBASE FATAL ERROR: ${Xt(...e)}`;throw et.error(t),new Error(t)},H=function(...e){let t="FIREBASE WARNING: "+Xt(...e);et.warn(t)},Ah=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&H("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ol=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Rh=function(e){if(ae()||document.readyState==="complete")e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},nt="[MIN_NAME]",Fe="[MAX_NAME]",ct=function(e,t){if(e===t)return 0;if(e===nt||t===Fe)return-1;if(t===nt||e===Fe)return 1;{let n=il(e),r=il(t);return n!==null?r!==null?n-r===0?e.length-t.length:n-r:-1:r!==null?1:e<t?-1:1}},Ph=function(e,t){return e===t?0:e<t?-1:1},qt=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+N(t))},$i=function(e){if(typeof e!="object"||e===null)return N(e);let t=[];for(let r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)r!==0&&(n+=","),n+=N(t[r]),n+=":",n+=$i(e[t[r]]);return n+="}",n},Ll=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let s=0;s<n;s+=t)s+t>n?r.push(e.substring(s,n)):r.push(e.substring(s,s+t));return r};function ee(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}var ql=function(e){f(!Ol(e),"Invalid JSON number");let t=11,n=52,r=(1<<t-1)-1,s,i,o,a,l;e===0?(i=0,o=0,s=1/e===-1/0?1:0):(s=e<0,e=Math.abs(e),e>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(e)/Math.LN2),r),i=a+r,o=Math.round(e*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(e/Math.pow(2,1-r-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=t;l;l-=1)c.push(i%2?1:0),i=Math.floor(i/2);c.push(s?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},bh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},xh=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};var Nh=new RegExp("^-?(0*)\\d{1,10}$"),Dh=-2147483648,kh=2147483647,il=function(e){if(Nh.test(e)){let t=Number(e);if(t>=Dh&&t<=kh)return t}return null},Zt=function(e){try{e()}catch(t){setTimeout(()=>{let n=t.stack||"";throw H("Exception was thrown by user callback.",n),t},Math.floor(0))}},Vh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},zt=function(e,t){let n=setTimeout(e,t);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var ni=class{constructor(t,n){this.appName_=t,this.appCheckProvider=n,this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(r=>this.appCheck=r)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(n,r):n(null)},0)})}addTokenChangeListener(t){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(r=>r.addTokenListener(t))}notifyForInvalidToken(){H(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var ri=class{constructor(t,n,r){this.appName_=t,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(n=>n&&n.code==="auth/token-not-initialized"?(B("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(n,r):n(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(n=>n.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(n=>n.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',H(t)}},Kt=(()=>{class e{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}e.OWNER="owner";return e})(),hr="5",Ul="v",Bl="s",Gl="r",$l="f",zl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Kl="ls",jl="p",si="ac",Wl="websocket",Ql="long_polling";var dr=class{constructor(t,n,r,s,i=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ke.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&ke.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){let t=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${n}`}};function Fh(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function Hl(e,t,n){f(typeof t=="string","typeof type must == string"),f(typeof n=="object","typeof params must == object");let r;if(t===Wl)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===Ql)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);Fh(e)&&(n.ns=e.namespace);let s=[];return ee(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}var ii=class{constructor(){this.counters_={}}incrementCounter(t,n=1){le(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=n}get(){return ho(this.counters_)}};var Ks={},js={};function zi(e){let t=e.toString();return Ks[t]||(Ks[t]=new ii),Ks[t]}function Mh(e,t){let n=e.toString();return js[n]||(js[n]=t()),js[n]}var oi=class{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,n){this.closeAfterResponse=t,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,n){for(this.pendingResponses[t]=n;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Zt(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ol="start",Oh="close",Lh="pLPCommand",qh="pRTLPCB",Yl="id",Xl="pw",Jl="ser",Uh="cb",Bh="seg",Gh="ts",$h="d",zh="dframe",Zl=1870,ec=30,Kh=Zl-ec,jh=25e3,Wh=3e4,ai=class e{constructor(t,n,r,s,i,o,a){this.connId=t,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Jt(t),this.stats_=zi(n),this.urlFn=l=>(this.appCheckToken&&(l[si]=this.appCheckToken),Hl(n,Ql,l))}open(t,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new oi(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Wh)),Rh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new li((...i)=>{let[o,a,l,c,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ol)this.id=a,this.password=l;else if(o===Oh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{let[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[ol]="t",r[Jl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Uh]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Ul]=hr,this.transportSessionId&&(r[Bl]=this.transportSessionId),this.lastSessionId&&(r[Kl]=this.lastSessionId),this.applicationId&&(r[jl]=this.applicationId),this.appCheckToken&&(r[si]=this.appCheckToken),typeof location<"u"&&location.hostname&&zl.test(location.hostname)&&(r[Gl]=$l);let s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){e.forceAllow_=!0}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){return ae()?!1:e.forceAllow_?!0:!e.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!bh()&&!xh()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){let n=N(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let r=uo(n),s=Ll(r,Kh);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(t,n){if(ae())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[zh]="t",r[Yl]=t,r[Xl]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){let n=N(t).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},li=class e{constructor(t,n,r,s){if(this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ae())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Ch(),window[Lh+this.uniqueCallbackIdentifier]=t,window[qh+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){B("frame writing exception"),a.stack&&B(a.stack),B(a)}}}static createIFrame_(){let t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||B("No IE domain setting required")}catch{let r=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,n){for(this.myID=t,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let t={};t[Yl]=this.myID,t[Xl]=this.myPW,t[Jl]=this.currentSerial;let n=this.urlFn(t),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ec+r.length<=Zl;){let o=this.pendingSegs.shift();r=r+"&"+Bh+s+"="+o.seg+"&"+Gh+s+"="+o.ts+"&"+$h+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(t,n,r){this.pendingSegs.push({seg:t,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(t,n){this.outstandingRequests.add(n);let r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(jh)),i=()=>{clearTimeout(s),r()};this.addTag(t,i)}addTag(t,n){ae()?this.doNodeLongPoll(t,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){let s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{B("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var Qh=16384,Hh=45e3,fr=null;typeof MozWebSocket<"u"?fr=MozWebSocket:typeof WebSocket<"u"&&(fr=WebSocket);var Ut=(()=>{class e{constructor(n,r,s,i,o,a,l){this.connId=n,this.applicationId=s,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Jt(this.connId),this.stats_=zi(r),this.connURL=e.connectionURL_(r,a,l,i,s),this.nodeAdmin=r.nodeAdmin}static connectionURL_(n,r,s,i,o){let a={};return a[Ul]=hr,!ae()&&typeof location<"u"&&location.hostname&&zl.test(location.hostname)&&(a[Gl]=$l),r&&(a[Bl]=r),s&&(a[Kl]=s),i&&(a[si]=i),o&&(a[jl]=o),Hl(n,Wl,a)}open(n,r){this.onDisconnect=r,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ke.set("previous_websocket_failure",!0);try{let s;if(ae()){let i=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${hr}/${Gi}/${process.platform}/${i}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new fr(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(r);s&&s.length>1&&parseFloat(s[1])<4.4&&(n=!0)}return!n&&fr!==null&&!e.forceDisallow_}static previouslyFailed(){return ke.isInMemoryStorage||ke.get("previous_websocket_failure")===!0}markConnectionHealthy(){ke.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let s=dn(r);this.onMessage(s)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(f(this.frames===null,"We already have a frame buffer"),n.length<=6){let r=Number(n);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let r=n.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let s=this.extractFrameCount_(r);s!==null&&this.appendFrame_(s)}}send(n){this.resetKeepAlive();let r=N(n);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let s=Ll(r,Qh);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Hh))}sendString_(n){try{this.mySock.send(n)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4;return e})(),Yh=(()=>{class e{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[ai,Ut]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){let r=Ut&&Ut.isAvailable(),s=r&&!Ut.previouslyFailed();if(n.webSocketOnly&&(r||H("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ut];else{let i=this.transports_=[];for(let o of e.ALL_TRANSPORTS)o&&o.isAvailable()&&i.push(o);e.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}e.globalTransportInitialized_=!1;return e})(),Xh=6e4,Jh=5e3,Zh=10*1024,ed=100*1024,Ws="t",al="d",td="s",ll="r",nd="e",cl="o",ul="a",hl="n",dl="p",rd="h",ci=class{constructor(t,n,r,s,i,o,a,l,c,u){this.id=t,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Jt("c:"+this.id+":"),this.transportManager_=new Yh(n),this.log_("Connection created"),this.start_()}start_(){let t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));let s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=zt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ed?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Zh?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return n=>{t===this.conn_?this.onConnectionLost_(n):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return n=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(n):t===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(t){let n={t:"d",d:t};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Ws in t){let n=t[Ws];n===ul?this.upgradeIfSecondaryHealthy_():n===ll?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===cl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){let n=qt("t",t),r=qt("d",t);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:dl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ul,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:hl,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){let n=qt("t",t),r=qt("d",t);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){let n=qt(Ws,t);if(al in t){let r=t[al];if(n===rd){let s=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===hl){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===td?this.onConnectionShutdown_(r):n===ll?this.onReset_(r):n===nd?ti("Server Error: "+r):n===cl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ti("Unknown control packet command: "+n)}}onHandshake_(t){let n=t.ts,r=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),hr!==r&&H("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),zt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Xh))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,n){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):zt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Jh))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:dl,d:{}}}))}onSecondaryConnectionLost_(){let t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ke.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var mr=class{put(t,n,r,s){}merge(t,n,r,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,n,r){}onDisconnectMerge(t,n,r){}onDisconnectCancel(t,n){}reportStats(t){}};var pr=class{constructor(t){this.allowedEvents_=t,this.listeners_={},f(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){let r=[...this.listeners_[t]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(t,n,r){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:n,context:r});let s=this.getInitialEvent(t);s&&n.apply(r,s)}off(t,n,r){this.validateEventType_(t);let s=this.listeners_[t]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(t){f(this.allowedEvents_.find(n=>n===t),"Unknown event: "+t)}};var gr=class e extends pr{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Nr()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new e}getInitialEvent(t){return f(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}};var fl=32,ml=768,C=class{constructor(t,n){if(n===void 0){this.pieces_=t.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}toString(){let t="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(t+="/"+this.pieces_[n]);return t||"/"}};function T(){return new C("")}function w(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Se(e){return e.pieces_.length-e.pieceNum_}function A(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new C(e.pieces_,t)}function tc(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sd(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)e.pieces_[n]!==""&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function nc(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function rc(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new C(t,0)}function F(e,t){let n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof C)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{let r=t.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new C(n,0)}function y(e){return e.pieceNum_>=e.pieces_.length}function J(e,t){let n=w(e),r=w(t);if(n===null)return t;if(n===r)return J(A(e),A(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function sc(e,t){if(Se(e)!==Se(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function se(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Se(e)>Se(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var ui=class{constructor(t,n){this.errorPrefix_=n,this.parts_=nc(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=ft(this.parts_[r]);ic(this)}};function id(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=ft(t),ic(e)}function od(e){let t=e.parts_.pop();e.byteLength_-=ft(t),e.parts_.length>0&&(e.byteLength_-=1)}function ic(e){if(e.byteLength_>ml)throw new Error(e.errorPrefix_+"has a key path longer than "+ml+" bytes ("+e.byteLength_+").");if(e.parts_.length>fl)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+fl+") or object contains a cycle "+De(e))}function De(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}var hi=class e extends pr{constructor(){super(["visible"]);let t,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let r=!document[t];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new e}getInitialEvent(t){return f(t==="visible","Unknown event type: "+t),[this.visible_]}};var Bt=1e3,ad=60*5*1e3,pl=30*1e3,ld=1.3,cd=3e4,ud="server_kill",gl=3,Ki=(()=>{class e extends mr{constructor(n,r,s,i,o,a,l,c){if(super(),this.repoInfo_=n,this.applicationId_=r,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=e.nextPersistentConnectionId_++,this.log_=Jt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Bt,this.maxReconnectDelay_=ad,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!ae())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");hi.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&gr.getInstance().on("online",this.onOnline_,this)}sendRequest(n,r,s){let i=++this.requestNumber_,o={r:i,a:n,b:r};this.log_(N(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[i]=s)}get(n){this.initConnection_();let r=new xr,i={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(n,r,s,i){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:i,hashFn:r,query:n,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(n){let r=this.outstandingGets_[n];this.sendRequest("g",r.request,s=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(s)})}sendListen_(n){let r=n.query,s=r._path.toString(),i=r._queryIdentifier;this.log_("Listen on "+s+" for "+i);let o={p:s},a="q";n.tag&&(o.q=r._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;e.warnOnListenWarnings_(c,r),(this.listens.get(s)&&this.listens.get(s).get(i))===n&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(s,i),n.onComplete&&n.onComplete(u,c))})}static warnOnListenWarnings_(n,r){if(n&&typeof n=="object"&&le(n,"w")){let s=Ae(n,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let i='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();H(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||go(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=pl)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,r=po(n)?"auth":"gauth",s={cred:n};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(r,s,i=>{let o=i.s,a=i.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let r=n.s,s=n.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,s)})}unlisten(n,r){let s=n._path.toString(),i=n._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),f(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,n._queryObject,r)}sendUnlisten_(n,r,s,i){this.log_("Unlisten on "+n+" for "+r);let o={p:n},a="n";i&&(o.q=s,o.t=i),this.sendRequest(a,o)}onDisconnectPut(n,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,r,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:r,onComplete:s})}onDisconnectMerge(n,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,r,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:r,onComplete:s})}onDisconnectCancel(n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,r):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(n,r,s,i){let o={p:r,d:s};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{i&&setTimeout(()=>{i(a.s,a.d)},Math.floor(0))})}put(n,r,s,i){this.putInternal("p",n,r,s,i)}merge(n,r,s,i){this.putInternal("m",n,r,s,i)}putInternal(n,r,s,i,o){this.initConnection_();let a={p:r,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:i}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(n){let r=this.outstandingPuts_[n].action,s=this.outstandingPuts_[n].request,i=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(r,s,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(o.s,o.d)})}reportStats(n){if(this.connected_){let r={c:n};this.log_("reportStats",r),this.sendRequest("s",r,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+N(n));let r=n.r,s=this.requestCBHash_[r];s&&(delete this.requestCBHash_[r],s(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,r){this.log_("handleServerMessage",n,r),n==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):n==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):n==="c"?this.onListenRevoked_(r.p,r.q):n==="ac"?this.onAuthRevoked_(r.s,r.d):n==="apc"?this.onAppCheckRevoked_(r.s,r.d):n==="sd"?this.onSecurityDebugPacket_(r):ti("Unrecognized action received from server: "+N(n)+`
Are you using the latest client?`)}onReady_(n,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>cd&&(this.reconnectDelay_=Bt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-n);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*ld)}this.onConnectStatus_(!1)}establishConnection_(){return ve(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},u=function(d){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,g]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?B("getToken() completed but was canceled"):(B("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=g&&g.token,l=new ci(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,r,s,_=>{H(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(ud)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&H(d),c())}}})}interrupt(n){B("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){B("Resuming connection for reason: "+n),delete this.interruptReasons_[n],Dr(this.interruptReasons_)&&(this.reconnectDelay_=Bt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let r=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let r=this.outstandingPuts_[n];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,r){let s;r?s=r.map(o=>$i(o)).join("$"):s="default";let i=this.removeListen_(n,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(n,r){let s=new C(n).toString(),i;if(this.listens.has(s)){let o=this.listens.get(s);i=o.get(r),o.delete(r),o.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(n,r){B("Auth token revoked: "+n+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=gl&&(this.reconnectDelay_=pl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,r){B("App check token revoked: "+n+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=gl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let r of n.values())this.sendListen_(r);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},r="js";ae()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),n["sdk."+r+"."+Gi.replace(/\./g,"-")]=1,Nr()?n["framework.cordova"]=1:fo()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=gr.getInstance().currentlyOnline();return Dr(this.interruptReasons_)&&n}}e.nextPersistentConnectionId_=0,e.nextConnectionId_=0;return e})(),E=class e{constructor(t,n){this.name=t,this.node=n}static Wrap(t,n){return new e(t,n)}};var rt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,n){let r=new E(nt,t),s=new E(nt,n);return this.compare(r,s)!==0}minPost(){return E.MIN}};var ur,_r=class extends rt{static get __EMPTY_NODE(){return ur}static set __EMPTY_NODE(t){ur=t}compare(t,n){return ct(t.name,n.name)}isDefinedOn(t){throw qe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,n){return!1}minPost(){return E.MIN}maxPost(){return new E(Fe,ur)}makePost(t,n){return f(typeof t=="string","KeyIndex indexValue must always be a string."),new E(t,ur)}toString(){return".key"}},tt=new _r;var Je=class{constructor(t,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!t.isEmpty();)if(t=t,o=n?r(t.key,n):1,s&&(o*=-1),o<0)this.isReverse_?t=t.left:t=t.right;else if(o===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(t.key,t.value):n={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}},re=(()=>{class e{constructor(n,r,s,i,o){this.key=n,this.value=r,this.color=s??e.RED,this.left=i??Z.EMPTY_NODE,this.right=o??Z.EMPTY_NODE}copy(n,r,s,i,o){return new e(n??this.key,r??this.value,s??this.color,i??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,r,s){let i=this,o=s(n,i.key);return o<0?i=i.copy(null,null,null,i.left.insert(n,r,s),null):o===0?i=i.copy(null,r,null,null,null):i=i.copy(null,null,null,null,i.right.insert(n,r,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Z.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,r){let s,i;if(s=this,r(n,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(n,r),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),r(n,s.key)===0){if(s.right.isEmpty())return Z.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(n,r))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,r)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})(),di=class{copy(t,n,r,s,i){return this}insert(t,n,r){return new re(t,n,null)}remove(t,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Z=class e{constructor(t,n=e.EMPTY_NODE){this.comparator_=t,this.root_=n}insert(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,re.BLACK,null,null))}remove(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,re.BLACK,null,null))}get(t){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(t,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(t){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(t,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Je(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,n){return new Je(this.root_,t,this.comparator_,!1,n)}getReverseIteratorFrom(t,n){return new Je(this.root_,t,this.comparator_,!0,n)}getReverseIterator(t){return new Je(this.root_,null,this.comparator_,!0,t)}};Z.EMPTY_NODE=new di;function hd(e,t){return ct(e.name,t.name)}function ji(e,t){return ct(e,t)}var fi;function dd(e){fi=e}var oc=function(e){return typeof e=="number"?"number:"+ql(e):"string:"+e},ac=function(e){if(e.isLeafNode()){let t=e.val();f(typeof t=="string"||typeof t=="number"||typeof t=="object"&&le(t,".sv"),"Priority must be a string or number.")}else f(e===fi||e.isEmpty(),"priority of unexpected type.");f(e===fi||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var _l,st=(()=>{class e{constructor(n,r=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=r,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),ac(this.priorityNode_)}static set __childrenNodeConstructor(n){_l=n}static get __childrenNodeConstructor(){return _l}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new e(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return y(n)?this:w(n)===".priority"?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,r){return null}updateImmediateChild(n,r){return n===".priority"?this.updatePriority(r):r.isEmpty()&&n!==".priority"?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,r).updatePriority(this.priorityNode_)}updateChild(n,r){let s=w(n);return s===null?r:r.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||Se(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(A(n),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,r){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+oc(this.priorityNode_.val())+":");let r=typeof this.value_;n+=r+":",r==="number"?n+=ql(this.value_):n+=this.value_,this.lazyHash_=Ml(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===e.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof e.__childrenNodeConstructor?-1:(f(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let r=typeof n.value_,s=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(r),o=e.VALUE_TYPE_ORDER.indexOf(s);return f(i>=0,"Unknown leaf type: "+r),f(o>=0,"Unknown leaf type: "+s),i===o?s==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-i}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let r=n;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}e.VALUE_TYPE_ORDER=["object","boolean","number","string"];return e})(),lc,cc;function fd(e){lc=e}function md(e){cc=e}var mi=class extends rt{compare(t,n){let r=t.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?ct(t.name,n.name):i}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,n){return!t.getPriority().equals(n.getPriority())}minPost(){return E.MIN}maxPost(){return new E(Fe,new st("[PRIORITY-POST]",cc))}makePost(t,n){let r=lc(t);return new E(n,new st("[PRIORITY-POST]",r))}toString(){return".priority"}},$=new mi;var pd=Math.log(2),pi=class{constructor(t){let n=i=>parseInt(Math.log(i)/pd,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(t+1),this.current_=this.count-1;let s=r(this.count);this.bits_=t+1&s}nextBitIsOne(){let t=!(this.bits_&1<<this.current_);return this.current_--,t}},yr=function(e,t,n,r){e.sort(t);let s=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=e[l],d=n?n(h):h,new re(d,h.node,re.BLACK,null,null);{let g=parseInt(u/2,10)+l,_=s(l,g),b=s(g+1,c);return h=e[g],d=n?n(h):h,new re(d,h.node,re.BLACK,_,b)}},i=function(l){let c=null,u=null,h=e.length,d=function(_,b){let Y=h-_,Pr=h;h-=_;let rn=s(Y+1,Pr),br=e[Y],Yc=n?n(br):br;g(new re(Yc,br.node,b,null,rn))},g=function(_){c?(c.left=_,c=_):(u=_,c=_)};for(let _=0;_<l.count;++_){let b=l.nextBitIsOne(),Y=Math.pow(2,l.count-(_+1));b?d(Y,re.BLACK):(d(Y,re.BLACK),d(Y,re.RED))}return u},o=new pi(e.length),a=i(o);return new Z(r||t,a)};var Qs,Xe={},it=class e{constructor(t,n){this.indexes_=t,this.indexSet_=n}static get Default(){return f(Xe&&$,"ChildrenNode.ts has not been loaded"),Qs=Qs||new e({".priority":Xe},{".priority":$}),Qs}get(t){let n=Ae(this.indexes_,t);if(!n)throw new Error("No index defined for "+t);return n instanceof Z?n:null}hasIndex(t){return le(this.indexSet_,t.toString())}addIndex(t,n){f(t!==tt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],s=!1,i=n.getIterator(E.Wrap),o=i.getNext();for(;o;)s=s||t.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=yr(r,t.getCompare()):a=Xe;let l=t.toString(),c=Object.assign({},this.indexSet_);c[l]=t;let u=Object.assign({},this.indexes_);return u[l]=a,new e(u,c)}addToIndexes(t,n){let r=dt(this.indexes_,(s,i)=>{let o=Ae(this.indexSet_,i);if(f(o,"Missing index implementation for "+i),s===Xe)if(o.isDefinedOn(t.node)){let a=[],l=n.getIterator(E.Wrap),c=l.getNext();for(;c;)c.name!==t.name&&a.push(c),c=l.getNext();return a.push(t),yr(a,o.getCompare())}else return Xe;else{let a=n.get(t.name),l=s;return a&&(l=l.remove(new E(t.name,a))),l.insert(t,t.node)}});return new e(r,this.indexSet_)}removeFromIndexes(t,n){let r=dt(this.indexes_,s=>{if(s===Xe)return s;{let i=n.get(t.name);return i?s.remove(new E(t.name,i)):s}});return new e(r,this.indexSet_)}};var Gt,R=(()=>{class e{constructor(n,r,s){this.children_=n,this.priorityNode_=r,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&ac(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Gt||(Gt=new e(new Z(ji),null,it.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Gt}updatePriority(n){return this.children_.isEmpty()?this:new e(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let r=this.children_.get(n);return r===null?Gt:r}}getChild(n){let r=w(n);return r===null?this:this.getImmediateChild(r).getChild(A(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,r){if(f(r,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(r);{let s=new E(n,r),i,o;r.isEmpty()?(i=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(n,r),o=this.indexMap_.addToIndexes(s,this.children_));let a=i.isEmpty()?Gt:this.priorityNode_;return new e(i,a,o)}}updateChild(n,r){let s=w(n);if(s===null)return r;{f(w(n)!==".priority"||Se(n)===1,".priority must be the last token in a path");let i=this.getImmediateChild(s).updateChild(A(n),r);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let r={},s=0,i=0,o=!0;if(this.forEachChild($,(a,l)=>{r[a]=l.val(n),s++,o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!n&&o&&i<2*s){let a=[];for(let l in r)a[l]=r[l];return a}else return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+oc(this.getPriority().val())+":"),this.forEachChild($,(r,s)=>{let i=s.hash();i!==""&&(n+=":"+r+":"+i)}),this.lazyHash_=n===""?"":Ml(n)}return this.lazyHash_}getPredecessorChildName(n,r,s){let i=this.resolveIndex_(s);if(i){let o=i.getPredecessorKey(new E(n,r));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let r=this.resolveIndex_(n);if(r){let s=r.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(n){let r=this.getFirstChildName(n);return r?new E(r,this.children_.get(r)):null}getLastChildName(n){let r=this.resolveIndex_(n);if(r){let s=r.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(n){let r=this.getLastChildName(n);return r?new E(r,this.children_.get(r)):null}forEachChild(n,r){let s=this.resolveIndex_(n);return s?s.inorderTraversal(i=>r(i.name,i.node)):this.children_.inorderTraversal(r)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,r){let s=this.resolveIndex_(r);if(s)return s.getIteratorFrom(n,i=>i);{let i=this.children_.getIteratorFrom(n.name,E.Wrap),o=i.peek();for(;o!=null&&r.compare(o,n)<0;)i.getNext(),o=i.peek();return i}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,r){let s=this.resolveIndex_(r);if(s)return s.getReverseIteratorFrom(n,i=>i);{let i=this.children_.getReverseIteratorFrom(n.name,E.Wrap),o=i.peek();for(;o!=null&&r.compare(o,n)>0;)i.getNext(),o=i.peek();return i}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===en?-1:0}withIndex(n){if(n===tt||this.indexMap_.hasIndex(n))return this;{let r=this.indexMap_.addIndex(n,this.children_);return new e(this.children_,this.priorityNode_,r)}}isIndexed(n){return n===tt||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let r=n;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let s=this.getIterator($),i=r.getIterator($),o=s.getNext(),a=i.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=i.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===tt?null:this.indexMap_.get(n.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})(),gi=class extends R{constructor(){super(new Z(ji),R.EMPTY_NODE,it.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return R.EMPTY_NODE}isEmpty(){return!1}},en=new gi;Object.defineProperties(E,{MIN:{value:new E(nt,R.EMPTY_NODE)},MAX:{value:new E(Fe,en)}});_r.__EMPTY_NODE=R.EMPTY_NODE;st.__childrenNodeConstructor=R;dd(en);md(en);var gd=!0;function G(e,t=null){if(e===null)return R.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(t=e[".priority"]),f(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){let n=e;return new st(n,G(t))}if(!(e instanceof Array)&&gd){let n=[],r=!1;if(ee(e,(o,a)=>{if(o.substring(0,1)!=="."){let l=G(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),n.push(new E(o,l)))}}),n.length===0)return R.EMPTY_NODE;let i=yr(n,hd,o=>o.name,ji);if(r){let o=yr(n,$.getCompare());return new R(i,G(t),new it({".priority":o},{".priority":$}))}else return new R(i,G(t),it.Default)}else{let n=R.EMPTY_NODE;return ee(e,(r,s)=>{if(le(e,r)&&r.substring(0,1)!=="."){let i=G(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(G(t))}}fd(G);var _i=class extends rt{constructor(t){super(),this.indexPath_=t,f(!y(t)&&w(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,n){let r=this.extractChild(t.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?ct(t.name,n.name):i}makePost(t,n){let r=G(t),s=R.EMPTY_NODE.updateChild(this.indexPath_,r);return new E(n,s)}maxPost(){let t=R.EMPTY_NODE.updateChild(this.indexPath_,en);return new E(Fe,t)}toString(){return nc(this.indexPath_,0).join("/")}};var yi=class extends rt{compare(t,n){let r=t.node.compareTo(n.node);return r===0?ct(t.name,n.name):r}isDefinedOn(t){return!0}indexedValueChanged(t,n){return!t.equals(n)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(t,n){let r=G(t);return new E(n,r)}toString(){return".value"}},_d=new yi;function yd(e){return{type:"value",snapshotNode:e}}function vd(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function wd(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function yl(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function Ed(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}var vi=class e{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:nt}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Fe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$}copy(){let t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function vl(e){let t={};if(e.isDefault())return t;let n;if(e.index_===$?n="$priority":e.index_===_d?n="$value":e.index_===tt?n="$key":(f(e.index_ instanceof _i,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=N(n),e.startSet_){let r=e.startAfterSet_?"startAfter":"startAt";t[r]=N(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+N(e.indexStartName_))}if(e.endSet_){let r=e.endBeforeSet_?"endBefore":"endAt";t[r]=N(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+N(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function wl(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;n===""&&(e.isViewFromLeft()?n="l":n="r"),t.vf=n}return e.index_!==$&&(t.i=e.index_.toString()),t}var wi=class e extends mr{constructor(t,n,r,s){super(),this.repoInfo_=t,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Jt("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,n){return n!==void 0?"tag$"+n:(f(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,n,r,s){let i=t._path.toString();this.log_("Listen called for "+i+" "+t._queryIdentifier);let o=e.getListenId_(t,r),a={};this.listens_[o]=a;let l=vl(t._queryParams);this.restRequest_(i+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(i,h,!1,r),Ae(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(t,n){let r=e.getListenId_(t,n);delete this.listens_[r]}get(t){let n=vl(t._queryParams),r=t._path.toString(),s=new xr;return this.restRequest_(r+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(t){}restRequest_(t,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+_o(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=dn(a.responseText)}catch{H("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&H("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var Ei=class{constructor(){this.rootNode_=R.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,n){this.rootNode_=this.rootNode_.updateChild(t,n)}};function vr(){return{value:null,children:new Map}}function uc(e,t,n){if(y(t))e.value=n,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(t,n);else{let r=w(t);e.children.has(r)||e.children.set(r,vr());let s=e.children.get(r);t=A(t),uc(s,t,n)}}function Ii(e,t,n){e.value!==null?n(t,e.value):Id(e,(r,s)=>{let i=new C(t.toString()+"/"+r);Ii(s,i,n)})}function Id(e,t){e.children.forEach((n,r)=>{t(r,n)})}var Ti=class{constructor(t){this.collection_=t,this.last_=null}get(){let t=this.collection_.get(),n=Object.assign({},t);return this.last_&&ee(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=t,n}};var El=10*1e3,Td=30*1e3,Cd=5*60*1e3,Ci=class{constructor(t,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Ti(t);let r=El+(Td-El)*Math.random();zt(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let t=this.statsListener_.get(),n={},r=!1;ee(t,(s,i)=>{i>0&&le(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),zt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Cd))}};var _e=function(e){return e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",e}(_e||{});function hc(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function dc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fc(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}var Si=class e{constructor(t,n,r){this.path=t,this.affectedTree=n,this.revert=r,this.type=_e.ACK_USER_WRITE,this.source=hc()}operationForChild(t){if(y(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new C(t));return new e(T(),n,this.revert)}}else return f(w(this.path)===t,"operationForChild called for unrelated child."),new e(A(this.path),this.affectedTree,this.revert)}};var ot=class e{constructor(t,n,r){this.source=t,this.path=n,this.snap=r,this.type=_e.OVERWRITE}operationForChild(t){return y(this.path)?new e(this.source,T(),this.snap.getImmediateChild(t)):new e(this.source,A(this.path),this.snap)}};var wr=class e{constructor(t,n,r){this.source=t,this.path=n,this.children=r,this.type=_e.MERGE}operationForChild(t){if(y(this.path)){let n=this.children.subtree(new C(t));return n.isEmpty()?null:n.value?new ot(this.source,T(),n.value):new e(this.source,T(),n)}else return f(w(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,A(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Qt=class{constructor(t,n,r){this.node_=t,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(y(t))return this.isFullyInitialized()&&!this.filtered_;let n=w(t);return this.isCompleteForChild(n)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}};function Sd(e,t,n,r){let s=[],i=[];return t.forEach(o=>{o.type==="child_changed"&&e.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Ed(o.childName,o.snapshotNode))}),$t(e,s,"child_removed",t,r,n),$t(e,s,"child_added",t,r,n),$t(e,s,"child_moved",i,r,n),$t(e,s,"child_changed",t,r,n),$t(e,s,"value",t,r,n),s}function $t(e,t,n,r,s,i){let o=r.filter(a=>a.type===n);o.sort((a,l)=>Rd(e,a,l)),o.forEach(a=>{let l=Ad(e,a,i);s.forEach(c=>{c.respondsTo(a.type)&&t.push(c.createEvent(l,e.query_))})})}function Ad(e,t,n){return t.type==="value"||t.type==="child_removed"||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function Rd(e,t,n){if(t.childName==null||n.childName==null)throw qe("Should only compare child_ events.");let r=new E(t.childName,t.snapshotNode),s=new E(n.childName,n.snapshotNode);return e.index_.compare(r,s)}function mc(e,t){return{eventCache:e,serverCache:t}}function jt(e,t,n,r){return mc(new Qt(t,n,r),e.serverCache)}function pc(e,t,n,r){return mc(e.eventCache,new Qt(t,n,r))}function Ai(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Me(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var Hs,Pd=()=>(Hs||(Hs=new Z(Ph)),Hs),j=class e{constructor(t,n=Pd()){this.value=t,this.children=n}static fromObject(t){let n=new e(null);return ee(t,(r,s)=>{n=n.set(new C(r),s)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,n){if(this.value!=null&&n(this.value))return{path:T(),value:this.value};if(y(t))return null;{let r=w(t),s=this.children.get(r);if(s!==null){let i=s.findRootMostMatchingPathAndValue(A(t),n);return i!=null?{path:F(new C(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(y(t))return this;{let n=w(t),r=this.children.get(n);return r!==null?r.subtree(A(t)):new e(null)}}set(t,n){if(y(t))return new e(n,this.children);{let r=w(t),i=(this.children.get(r)||new e(null)).set(A(t),n),o=this.children.insert(r,i);return new e(this.value,o)}}remove(t){if(y(t))return this.children.isEmpty()?new e(null):new e(null,this.children);{let n=w(t),r=this.children.get(n);if(r){let s=r.remove(A(t)),i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new e(null):new e(this.value,i)}else return this}}get(t){if(y(t))return this.value;{let n=w(t),r=this.children.get(n);return r?r.get(A(t)):null}}setTree(t,n){if(y(t))return n;{let r=w(t),i=(this.children.get(r)||new e(null)).setTree(A(t),n),o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new e(this.value,o)}}fold(t){return this.fold_(T(),t)}fold_(t,n){let r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(F(t,s),n)}),n(t,this.value,r)}findOnPath(t,n){return this.findOnPath_(t,T(),n)}findOnPath_(t,n,r){let s=this.value?r(n,this.value):!1;if(s)return s;if(y(t))return null;{let i=w(t),o=this.children.get(i);return o?o.findOnPath_(A(t),F(n,i),r):null}}foreachOnPath(t,n){return this.foreachOnPath_(t,T(),n)}foreachOnPath_(t,n,r){if(y(t))return this;{this.value&&r(n,this.value);let s=w(t),i=this.children.get(s);return i?i.foreachOnPath_(A(t),F(n,s),r):new e(null)}}foreach(t){this.foreach_(T(),t)}foreach_(t,n){this.children.inorderTraversal((r,s)=>{s.foreach_(F(t,r),n)}),this.value&&n(t,this.value)}foreachChild(t){this.children.inorderTraversal((n,r)=>{r.value&&t(n,r.value)})}};var ie=class e{constructor(t){this.writeTree_=t}static empty(){return new e(new j(null))}};function Wt(e,t,n){if(y(t))return new ie(new j(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(r!=null){let s=r.path,i=r.value,o=J(s,t);return i=i.updateChild(o,n),new ie(e.writeTree_.set(s,i))}else{let s=new j(n),i=e.writeTree_.setTree(t,s);return new ie(i)}}}function Il(e,t,n){let r=e;return ee(n,(s,i)=>{r=Wt(r,F(t,s),i)}),r}function Tl(e,t){if(y(t))return ie.empty();{let n=e.writeTree_.setTree(t,new j(null));return new ie(n)}}function Ri(e,t){return Oe(e,t)!=null}function Oe(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return n!=null?e.writeTree_.get(n.path).getChild(J(n.path,t)):null}function Cl(e){let t=[],n=e.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild($,(r,s)=>{t.push(new E(r,s))}):e.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&t.push(new E(r,s.value))}),t}function Ce(e,t){if(y(t))return e;{let n=Oe(e,t);return n!=null?new ie(new j(n)):new ie(e.writeTree_.subtree(t))}}function Pi(e){return e.writeTree_.isEmpty()}function at(e,t){return gc(T(),e.writeTree_,t)}function gc(e,t,n){if(t.value!=null)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((s,i)=>{s===".priority"?(f(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=gc(F(e,s),i,n)}),!n.getChild(e).isEmpty()&&r!==null&&(n=n.updateChild(F(e,".priority"),r)),n}}function _c(e,t){return Ic(t,e)}function bd(e,t,n,r,s){f(r>e.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(e.visibleWrites=Wt(e.visibleWrites,t,n)),e.lastWriteId=r}function xd(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}function Nd(e,t){let n=e.allWrites.findIndex(a=>a.writeId===t);f(n>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[n];e.allWrites.splice(n,1);let s=r.visible,i=!1,o=e.allWrites.length-1;for(;s&&o>=0;){let a=e.allWrites[o];a.visible&&(o>=n&&Dd(a,r.path)?s=!1:se(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return kd(e),!0;if(r.snap)e.visibleWrites=Tl(e.visibleWrites,r.path);else{let a=r.children;ee(a,l=>{e.visibleWrites=Tl(e.visibleWrites,F(r.path,l))})}return!0}else return!1}function Dd(e,t){if(e.snap)return se(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&se(F(e.path,n),t))return!0;return!1}function kd(e){e.visibleWrites=yc(e.allWrites,Vd,T()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function Vd(e){return e.visible}function yc(e,t,n){let r=ie.empty();for(let s=0;s<e.length;++s){let i=e[s];if(t(i)){let o=i.path,a;if(i.snap)se(n,o)?(a=J(n,o),r=Wt(r,a,i.snap)):se(o,n)&&(a=J(o,n),r=Wt(r,T(),i.snap.getChild(a)));else if(i.children){if(se(n,o))a=J(n,o),r=Il(r,a,i.children);else if(se(o,n))if(a=J(o,n),y(a))r=Il(r,T(),i.children);else{let l=Ae(i.children,w(a));if(l){let c=l.getChild(A(a));r=Wt(r,T(),c)}}}else throw qe("WriteRecord should have .snap or .children")}}return r}function vc(e,t,n,r,s){if(!r&&!s){let i=Oe(e.visibleWrites,t);if(i!=null)return i;{let o=Ce(e.visibleWrites,t);if(Pi(o))return n;if(n==null&&!Ri(o,T()))return null;{let a=n||R.EMPTY_NODE;return at(o,a)}}}else{let i=Ce(e.visibleWrites,t);if(!s&&Pi(i))return n;if(!s&&n==null&&!Ri(i,T()))return null;{let o=function(c){return(c.visible||s)&&(!r||!~r.indexOf(c.writeId))&&(se(c.path,t)||se(t,c.path))},a=yc(e.allWrites,o,t),l=n||R.EMPTY_NODE;return at(a,l)}}}function Fd(e,t,n){let r=R.EMPTY_NODE,s=Oe(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild($,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){let i=Ce(e.visibleWrites,t);return n.forEachChild($,(o,a)=>{let l=at(Ce(i,new C(o)),a);r=r.updateImmediateChild(o,l)}),Cl(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let i=Ce(e.visibleWrites,t);return Cl(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Md(e,t,n,r,s){f(r||s,"Either existingEventSnap or existingServerSnap must exist");let i=F(t,n);if(Ri(e.visibleWrites,i))return null;{let o=Ce(e.visibleWrites,i);return Pi(o)?s.getChild(n):at(o,s.getChild(n))}}function Od(e,t,n,r){let s=F(t,n),i=Oe(e.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){let o=Ce(e.visibleWrites,s);return at(o,r.getNode().getImmediateChild(n))}else return null}function Ld(e,t){return Oe(e.visibleWrites,t)}function qd(e,t,n,r,s,i,o){let a,l=Ce(e.visibleWrites,t),c=Oe(l,T());if(c!=null)a=c;else if(n!=null)a=at(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),g=d.getNext();for(;g&&u.length<s;)h(g,r)!==0&&u.push(g),g=d.getNext();return u}else return[]}function Ud(){return{visibleWrites:ie.empty(),allWrites:[],lastWriteId:-1}}function bi(e,t,n,r){return vc(e.writeTree,e.treePath,t,n,r)}function wc(e,t){return Fd(e.writeTree,e.treePath,t)}function Sl(e,t,n,r){return Md(e.writeTree,e.treePath,t,n,r)}function Er(e,t){return Ld(e.writeTree,F(e.treePath,t))}function Bd(e,t,n,r,s,i){return qd(e.writeTree,e.treePath,t,n,r,s,i)}function Wi(e,t,n){return Od(e.writeTree,e.treePath,t,n)}function Ec(e,t){return Ic(F(e.treePath,t),e.writeTree)}function Ic(e,t){return{treePath:e,writeTree:t}}var xi=class{constructor(){this.changeMap=new Map}trackChildChange(t){let n=t.type,r=t.childName;f(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),f(r!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(r);if(s){let i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,yl(r,t.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,wd(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,vd(r,t.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,yl(r,t.snapshotNode,s.oldSnap));else throw qe("Illegal combination of changes: "+t+" occurred after "+s)}else this.changeMap.set(r,t)}getChanges(){return Array.from(this.changeMap.values())}};var Ni=class{getCompleteChild(t){return null}getChildAfterChild(t,n,r){return null}},Tc=new Ni,Ht=class{constructor(t,n,r=null){this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(t){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(t))return n.getNode().getImmediateChild(t);{let r=this.optCompleteServerCache_!=null?new Qt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Wi(this.writes_,t,r)}}getChildAfterChild(t,n,r){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Me(this.viewCache_),i=Bd(this.writes_,s,n,1,r,t);return i.length===0?null:i[0]}};function Gd(e,t){f(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),f(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function $d(e,t,n,r,s){let i=new xi,o,a;if(n.type===_e.OVERWRITE){let c=n;c.source.fromUser?o=Di(e,t,c.path,c.snap,r,s,i):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!y(c.path),o=Ir(e,t,c.path,c.snap,r,s,a,i))}else if(n.type===_e.MERGE){let c=n;c.source.fromUser?o=Kd(e,t,c.path,c.children,r,s,i):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=ki(e,t,c.path,c.children,r,s,a,i))}else if(n.type===_e.ACK_USER_WRITE){let c=n;c.revert?o=Qd(e,t,c.path,r,s,i):o=jd(e,t,c.path,c.affectedTree,r,s,i)}else if(n.type===_e.LISTEN_COMPLETE)o=Wd(e,t,n.path,r,i);else throw qe("Unknown operation type: "+n.type);let l=i.getChanges();return zd(t,o,l),{viewCache:o,changes:l}}function zd(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Ai(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(yd(Ai(t)))}}function Cc(e,t,n,r,s,i){let o=t.eventCache;if(Er(r,n)!=null)return t;{let a,l;if(y(n))if(f(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let c=Me(t),u=c instanceof R?c:R.EMPTY_NODE,h=wc(r,u);a=e.filter.updateFullNode(t.eventCache.getNode(),h,i)}else{let c=bi(r,Me(t));a=e.filter.updateFullNode(t.eventCache.getNode(),c,i)}else{let c=w(n);if(c===".priority"){f(Se(n)===1,"Can't have a priority with additional path components");let u=o.getNode();l=t.serverCache.getNode();let h=Sl(r,n,u,l);h!=null?a=e.filter.updatePriority(u,h):a=o.getNode()}else{let u=A(n),h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();let d=Sl(r,n,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Wi(r,c,t.serverCache);h!=null?a=e.filter.updateChild(o.getNode(),c,h,u,s,i):a=o.getNode()}}return jt(t,a,o.isFullyInitialized()||y(n),e.filter.filtersNodes())}}function Ir(e,t,n,r,s,i,o,a){let l=t.serverCache,c,u=o?e.filter:e.filter.getIndexedFilter();if(y(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){let g=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),g,null)}else{let g=w(n);if(!l.isCompleteForPath(n)&&Se(n)>1)return t;let _=A(n),Y=l.getNode().getImmediateChild(g).updateChild(_,r);g===".priority"?c=u.updatePriority(l.getNode(),Y):c=u.updateChild(l.getNode(),g,Y,_,Tc,null)}let h=pc(t,c,l.isFullyInitialized()||y(n),u.filtersNodes()),d=new Ht(s,h,i);return Cc(e,h,n,s,d,a)}function Di(e,t,n,r,s,i,o){let a=t.eventCache,l,c,u=new Ht(s,t,i);if(y(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=jt(t,c,!0,e.filter.filtersNodes());else{let h=w(n);if(h===".priority")c=e.filter.updatePriority(t.eventCache.getNode(),r),l=jt(t,c,a.isFullyInitialized(),a.isFiltered());else{let d=A(n),g=a.getNode().getImmediateChild(h),_;if(y(d))_=r;else{let b=u.getCompleteChild(h);b!=null?tc(d)===".priority"&&b.getChild(rc(d)).isEmpty()?_=b:_=b.updateChild(d,r):_=R.EMPTY_NODE}if(g.equals(_))l=t;else{let b=e.filter.updateChild(a.getNode(),h,_,d,u,o);l=jt(t,b,a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Al(e,t){return e.eventCache.isCompleteForChild(t)}function Kd(e,t,n,r,s,i,o){let a=t;return r.foreach((l,c)=>{let u=F(n,l);Al(t,w(u))&&(a=Di(e,a,u,c,s,i,o))}),r.foreach((l,c)=>{let u=F(n,l);Al(t,w(u))||(a=Di(e,a,u,c,s,i,o))}),a}function Rl(e,t,n){return n.foreach((r,s)=>{t=t.updateChild(r,s)}),t}function ki(e,t,n,r,s,i,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l=t,c;y(n)?c=r:c=new j(null).setTree(n,r);let u=t.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let g=t.serverCache.getNode().getImmediateChild(h),_=Rl(e,g,d);l=Ir(e,l,new C(h),_,s,i,o,a)}}),c.children.inorderTraversal((h,d)=>{let g=!t.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!g){let _=t.serverCache.getNode().getImmediateChild(h),b=Rl(e,_,d);l=Ir(e,l,new C(h),b,s,i,o,a)}}),l}function jd(e,t,n,r,s,i,o){if(Er(s,n)!=null)return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(r.value!=null){if(y(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Ir(e,t,n,l.getNode().getChild(n),s,i,a,o);if(y(n)){let c=new j(null);return l.getNode().forEachChild(tt,(u,h)=>{c=c.set(new C(u),h)}),ki(e,t,n,c,s,i,a,o)}else return t}else{let c=new j(null);return r.foreach((u,h)=>{let d=F(n,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),ki(e,t,n,c,s,i,a,o)}}function Wd(e,t,n,r,s){let i=t.serverCache,o=pc(t,i.getNode(),i.isFullyInitialized()||y(n),i.isFiltered());return Cc(e,o,n,r,Tc,s)}function Qd(e,t,n,r,s,i){let o;if(Er(r,n)!=null)return t;{let a=new Ht(r,t,s),l=t.eventCache.getNode(),c;if(y(n)||w(n)===".priority"){let u;if(t.serverCache.isFullyInitialized())u=bi(r,Me(t));else{let h=t.serverCache.getNode();f(h instanceof R,"serverChildren would be complete if leaf node"),u=wc(r,h)}u=u,c=e.filter.updateFullNode(l,u,i)}else{let u=w(n),h=Wi(r,u,t.serverCache);h==null&&t.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=e.filter.updateChild(l,u,h,A(n),a,i):t.eventCache.getNode().hasChild(u)?c=e.filter.updateChild(l,u,R.EMPTY_NODE,A(n),a,i):c=l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=bi(r,Me(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,i)))}return o=t.serverCache.isFullyInitialized()||Er(r,T())!=null,jt(t,c,o,e.filter.filtersNodes())}}function Hd(e,t){let n=Me(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!y(t)&&!n.getImmediateChild(w(t)).isEmpty())?n.getChild(t):null}function Pl(e,t,n,r){t.type===_e.MERGE&&t.source.queryId!==null&&(f(Me(e.viewCache_),"We should always have a full cache before handling merges"),f(Ai(e.viewCache_),"Missing event cache, even though we have a server cache"));let s=e.viewCache_,i=$d(e.processor_,s,t,n,r);return Gd(e.processor_,i.viewCache),f(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=i.viewCache,Yd(e,i.changes,i.viewCache.eventCache.getNode(),null)}function Yd(e,t,n,r){let s=r?[r]:e.eventRegistrations_;return Sd(e.eventGenerator_,t,n,s)}var bl;function Xd(e){f(!bl,"__referenceConstructor has already been defined"),bl=e}function Qi(e,t,n,r){let s=t.source.queryId;if(s!==null){let i=e.views.get(s);return f(i!=null,"SyncTree gave us an op for an invalid query."),Pl(i,t,n,r)}else{let i=[];for(let o of e.views.values())i=i.concat(Pl(o,t,n,r));return i}}function Hi(e,t){let n=null;for(let r of e.views.values())n=n||Hd(r,t);return n}var xl;function Jd(e){f(!xl,"__referenceConstructor has already been defined"),xl=e}var Tr=class{constructor(t){this.listenProvider_=t,this.syncPointTree_=new j(null),this.pendingWriteTree_=Ud(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Zd(e,t,n,r,s){return bd(e.pendingWriteTree_,t,n,r,s),s?Sr(e,new ot(hc(),t,n)):[]}function Ze(e,t,n=!1){let r=xd(e.pendingWriteTree_,t);if(Nd(e.pendingWriteTree_,t)){let i=new j(null);return r.snap!=null?i=i.set(T(),!0):ee(r.children,o=>{i=i.set(new C(o),!0)}),Sr(e,new Si(r.path,i,n))}else return[]}function Cr(e,t,n){return Sr(e,new ot(dc(),t,n))}function ef(e,t,n){let r=j.fromObject(n);return Sr(e,new wr(dc(),t,r))}function tf(e,t,n,r){let s=Pc(e,r);if(s!=null){let i=bc(s),o=i.path,a=i.queryId,l=J(o,t),c=new ot(fc(a),l,n);return xc(e,o,c)}else return[]}function nf(e,t,n,r){let s=Pc(e,r);if(s){let i=bc(s),o=i.path,a=i.queryId,l=J(o,t),c=j.fromObject(n),u=new wr(fc(a),l,c);return xc(e,o,u)}else return[]}function Sc(e,t,n){let s=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(o,a)=>{let l=J(o,t),c=Hi(a,l);if(c)return c});return vc(s,t,i,n,!0)}function Sr(e,t){return Ac(t,e.syncPointTree_,null,_c(e.pendingWriteTree_,T()))}function Ac(e,t,n,r){if(y(e.path))return Rc(e,t,n,r);{let s=t.get(T());n==null&&s!=null&&(n=Hi(s,T()));let i=[],o=w(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,u=Ec(r,o);i=i.concat(Ac(a,l,c,u))}return s&&(i=i.concat(Qi(s,e,r,n))),i}}function Rc(e,t,n,r){let s=t.get(T());n==null&&s!=null&&(n=Hi(s,T()));let i=[];return t.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=Ec(r,o),u=e.operationForChild(o);u&&(i=i.concat(Rc(u,a,l,c)))}),s&&(i=i.concat(Qi(s,e,r,n))),i}function Pc(e,t){return e.tagToQueryMap.get(t)}function bc(e){let t=e.indexOf("$");return f(t!==-1&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new C(e.substr(0,t))}}function xc(e,t,n){let r=e.syncPointTree_.get(t);f(r,"Missing sync point for query tag that we're tracking");let s=_c(e.pendingWriteTree_,t);return Qi(r,n,s,null)}var Vi=class e{constructor(t){this.node_=t}getImmediateChild(t){let n=this.node_.getImmediateChild(t);return new e(n)}node(){return this.node_}},Fi=class e{constructor(t,n){this.syncTree_=t,this.path_=n}getImmediateChild(t){let n=F(this.path_,t);return new e(this.syncTree_,n)}node(){return Sc(this.syncTree_,this.path_)}},rf=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},Nl=function(e,t,n){if(!e||typeof e!="object")return e;if(f(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return sf(e[".sv"],t,n);if(typeof e[".sv"]=="object")return of(e[".sv"],t);f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},sf=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:f(!1,"Unexpected server value: "+e)}},of=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;typeof r!="number"&&f(!1,"Unexpected increment value: "+r);let s=t.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;let o=s.getValue();return typeof o!="number"?r:o+r},af=function(e,t,n,r){return Yi(t,new Fi(n,e),r)},lf=function(e,t,n){return Yi(e,new Vi(t),n)};function Yi(e,t,n){let r=e.getPriority().val(),s=Nl(r,t.getImmediateChild(".priority"),n),i;if(e.isLeafNode()){let o=e,a=Nl(o.getValue(),t,n);return a!==o.getValue()||s!==o.getPriority().val()?new st(a,G(s)):e}else{let o=e;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new st(s))),o.forEachChild($,(a,l)=>{let c=Yi(l,t.getImmediateChild(a),n);c!==l&&(i=i.updateImmediateChild(a,c))}),i}}var Yt=class{constructor(t="",n=null,r={children:{},childCount:0}){this.name=t,this.parent=n,this.node=r}};function Xi(e,t){let n=t instanceof C?t:new C(t),r=e,s=w(n);for(;s!==null;){let i=Ae(r.node.children,s)||{children:{},childCount:0};r=new Yt(s,r,i),n=A(n),s=w(n)}return r}function ut(e){return e.node.value}function Nc(e,t){e.node.value=t,Mi(e)}function Dc(e){return e.node.childCount>0}function cf(e){return ut(e)===void 0&&!Dc(e)}function Ar(e,t){ee(e.node.children,(n,r)=>{t(new Yt(n,e,r))})}function kc(e,t,n,r){n&&!r&&t(e),Ar(e,s=>{kc(s,t,!0,r)}),n&&r&&t(e)}function uf(e,t,n){let r=n?e:e.parent;for(;r!==null;){if(t(r))return!0;r=r.parent}return!1}function tn(e){return new C(e.parent===null?e.name:tn(e.parent)+"/"+e.name)}function Mi(e){e.parent!==null&&hf(e.parent,e.name,e)}function hf(e,t,n){let r=cf(n),s=le(e.node.children,t);r&&s?(delete e.node.children[t],e.node.childCount--,Mi(e)):!r&&!s&&(e.node.children[t]=n.node,e.node.childCount++,Mi(e))}var df=/[\[\].#$\/\u0000-\u001F\u007F]/,ff=/[\[\].#$\u0000-\u001F\u007F]/,Ys=10*1024*1024,Vc=function(e){return typeof e=="string"&&e.length!==0&&!df.test(e)},mf=function(e){return typeof e=="string"&&e.length!==0&&!ff.test(e)},pf=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),mf(e)};var Fc=function(e,t,n){let r=n instanceof C?new ui(n,e):n;if(t===void 0)throw new Error(e+"contains undefined "+De(r));if(typeof t=="function")throw new Error(e+"contains a function "+De(r)+" with contents = "+t.toString());if(Ol(t))throw new Error(e+"contains "+t.toString()+" "+De(r));if(typeof t=="string"&&t.length>Ys/3&&ft(t)>Ys)throw new Error(e+"contains a string greater than "+Ys+" utf8 bytes "+De(r)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let s=!1,i=!1;if(ee(t,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Vc(o)))throw new Error(e+" contains an invalid key ("+o+") "+De(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);id(r,o),Fc(e,a,r),od(r)}),s&&i)throw new Error(e+' contains ".value" child '+De(r)+" in addition to actual children.")}};var gf=function(e,t){let n=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Vc(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!pf(n))throw new Error(vo(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Oi=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function _f(e,t){let n=null;for(let r=0;r<t.length;r++){let s=t[r],i=s.getPath();n!==null&&!sc(i,n.path)&&(e.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&e.eventLists_.push(n)}function Le(e,t,n){_f(e,n),yf(e,r=>se(r,t)||se(t,r))}function yf(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let s=e.eventLists_[r];if(s){let i=s.path;t(i)?(vf(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function vf(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(n!==null){e.events[t]=null;let r=n.getEventRunner();Ve&&B("event: "+n.toString()),Zt(r)}}}var wf="repo_interrupt",Ef=25,Li=class{constructor(t,n,r,s){this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Oi,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=vr(),this.transactionQueueTree_=new Yt,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function If(e,t,n){if(e.stats_=zi(e.repoInfo_),e.forceRestClient_||Vh())e.server_=new wi(e.repoInfo_,(r,s,i,o)=>{Dl(e,r,s,i,o)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>kl(e,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{N(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new Ki(e.repoInfo_,t,(r,s,i,o)=>{Dl(e,r,s,i,o)},r=>{kl(e,r)},r=>{Cf(e,r)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(r=>{e.server_.refreshAuthToken(r)}),e.appCheckProvider_.addTokenChangeListener(r=>{e.server_.refreshAppCheckToken(r.token)}),e.statsReporter_=Mh(e.repoInfo_,()=>new Ci(e.stats_,e.server_)),e.infoData_=new Ei,e.infoSyncTree_=new Tr({startListening:(r,s,i,o)=>{let a=[],l=e.infoData_.getNode(r._path);return l.isEmpty()||(a=Cr(e.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ji(e,"connected",!1),e.serverSyncTree_=new Tr({startListening:(r,s,i,o)=>(e.server_.listen(r,i,s,(a,l)=>{let c=o(a,l);Le(e.eventQueue_,r._path,c)}),[]),stopListening:(r,s)=>{e.server_.unlisten(r,s)}})}function Tf(e){let n=e.infoData_.getNode(new C(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Mc(e){return rf({timestamp:Tf(e)})}function Dl(e,t,n,r,s){e.dataUpdateCount++;let i=new C(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(r){let l=dt(n,c=>G(c));o=nf(e.serverSyncTree_,i,l,s)}else{let l=G(n);o=tf(e.serverSyncTree_,i,l,s)}else if(r){let l=dt(n,c=>G(c));o=ef(e.serverSyncTree_,i,l)}else{let l=G(n);o=Cr(e.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=eo(e,i)),Le(e.eventQueue_,a,o)}function kl(e,t){Ji(e,"connected",t),t===!1&&Af(e)}function Cf(e,t){ee(t,(n,r)=>{Ji(e,n,r)})}function Ji(e,t,n){let r=new C("/.info/"+t),s=G(n);e.infoData_.updateSnapshot(r,s);let i=Cr(e.infoSyncTree_,r,s);Le(e.eventQueue_,r,i)}function Sf(e){return e.nextWriteId_++}function Af(e){Oc(e,"onDisconnectEvents");let t=Mc(e),n=vr();Ii(e.onDisconnect_,T(),(s,i)=>{let o=af(s,i,e.serverSyncTree_,t);uc(n,s,o)});let r=[];Ii(n,T(),(s,i)=>{r=r.concat(Cr(e.serverSyncTree_,s,i));let o=xf(e,s);eo(e,o)}),e.onDisconnect_=vr(),Le(e.eventQueue_,T(),r)}function Rf(e){e.persistentConnection_&&e.persistentConnection_.interrupt(wf)}function Oc(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),B(n,...t)}function Lc(e,t,n){return Sc(e.serverSyncTree_,t,n)||R.EMPTY_NODE}function Zi(e,t=e.transactionQueueTree_){if(t||Rr(e,t),ut(t)){let n=Uc(e,t);f(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&Pf(e,tn(t),n)}else Dc(t)&&Ar(t,n=>{Zi(e,n)})}function Pf(e,t,n){let r=n.map(c=>c.currentWriteId),s=Lc(e,t,r),i=s,o=s.hash();for(let c=0;c<n.length;c++){let u=n[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=J(t,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}let a=i.val(!0),l=t;e.server_.put(l.toString(),a,c=>{Oc(e,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<n.length;d++)n[d].status=2,u=u.concat(Ze(e.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&h.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();Rr(e,Xi(e.transactionQueueTree_,t)),Zi(e,e.transactionQueueTree_),Le(e.eventQueue_,t,u);for(let d=0;d<h.length;d++)Zt(h[d])}else{if(c==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{H("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=c}eo(e,t)}},o)}function eo(e,t){let n=qc(e,t),r=tn(n),s=Uc(e,n);return bf(e,s,r),r}function bf(e,t,n){if(t.length===0)return;let r=[],s=[],o=t.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<t.length;a++){let l=t[a],c=J(n,l.path),u=!1,h;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,s=s.concat(Ze(e.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Ef)u=!0,h="maxretry",s=s.concat(Ze(e.serverSyncTree_,l.currentWriteId,!0));else{let d=Lc(e,l.path,o);l.currentInputSnapshot=d;let g=t[a].update(d.val());if(g!==void 0){Fc("transaction failed: Data returned ",g,l.path);let _=G(g);typeof g=="object"&&g!=null&&le(g,".priority")||(_=_.updatePriority(d.getPriority()));let Y=l.currentWriteId,Pr=Mc(e),rn=lf(_,d,Pr);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=rn,l.currentWriteId=Sf(e),o.splice(o.indexOf(Y),1),s=s.concat(Zd(e.serverSyncTree_,l.path,rn,l.currentWriteId,l.applyLocally)),s=s.concat(Ze(e.serverSyncTree_,Y,!0))}else u=!0,h="nodata",s=s.concat(Ze(e.serverSyncTree_,l.currentWriteId,!0))}Le(e.eventQueue_,n,s),s=[],u&&(t[a].status=2,function(d){setTimeout(d,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&(h==="nodata"?r.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):r.push(()=>t[a].onComplete(new Error(h),!1,null))))}Rr(e,e.transactionQueueTree_);for(let a=0;a<r.length;a++)Zt(r[a]);Zi(e,e.transactionQueueTree_)}function qc(e,t){let n,r=e.transactionQueueTree_;for(n=w(t);n!==null&&ut(r)===void 0;)r=Xi(r,n),t=A(t),n=w(t);return r}function Uc(e,t){let n=[];return Bc(e,t,n),n.sort((r,s)=>r.order-s.order),n}function Bc(e,t,n){let r=ut(t);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);Ar(t,s=>{Bc(e,s,n)})}function Rr(e,t){let n=ut(t);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,Nc(t,n.length>0?n:void 0)}Ar(t,r=>{Rr(e,r)})}function xf(e,t){let n=tn(qc(e,t)),r=Xi(e.transactionQueueTree_,t);return uf(r,s=>{Xs(e,s)}),Xs(e,r),kc(r,s=>{Xs(e,s)}),n}function Xs(e,t){let n=ut(t);if(n){let r=[],s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(f(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(f(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ze(e.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Nc(t,void 0):n.length=i+1,Le(e.eventQueue_,tn(t),s);for(let o=0;o<r.length;o++)Zt(r[o])}}function Nf(e){let t="",n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}t+="/"+s}return t}function Df(e){let t={};e.charAt(0)==="?"&&(e=e.substring(1));for(let n of e.split("&")){if(n.length===0)continue;let r=n.split("=");r.length===2?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):H(`Invalid query segment '${n}' in query '${e}'`)}return t}var Vl=function(e,t){let n=kf(e),r=n.namespace;n.domain==="firebase.com"&&ye(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ye("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Ah();let s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new dr(n.host,n.secure,r,s,t,"",r!==n.subdomain),path:new C(n.pathString)}},kf=function(e){let t="",n="",r="",s="",i="",o=!0,a="https",l=443;if(typeof e=="string"){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");u===-1&&(u=e.length);let h=e.indexOf("?");h===-1&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(s=Nf(e.substring(u,h)));let d=Df(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(t.substring(c+1),10)):c=t.length;let g=t.slice(0,c);if(g.toLowerCase()==="localhost")n="localhost";else if(g.split(".").length<=2)n=g;else{let _=t.indexOf(".");r=t.substring(0,_).toLowerCase(),n=t.substring(_+1),i=r}"ns"in d&&(i=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};var qi=class e{constructor(t,n,r,s){this._repo=t,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return y(this._path)?null:tc(this._path)}get ref(){return new lt(this._repo,this._path)}get _queryIdentifier(){let t=wl(this._queryParams),n=$i(t);return n==="{}"?"default":n}get _queryObject(){return wl(this._queryParams)}isEqual(t){if(t=fn(t),!(t instanceof e))return!1;let n=this._repo===t._repo,r=sc(this._path,t._path),s=this._queryIdentifier===t._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+sd(this._path)}};var lt=class e extends qi{constructor(t,n){super(t,n,new vi,!1)}get parent(){let t=rc(this._path);return t===null?null:new e(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}};Xd(lt);Jd(lt);var Vf="FIREBASE_DATABASE_EMULATOR_HOST",Ui={},Ff=!1;function Mf(e,t,n,r){e.repoInfo_=new dr(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}function Of(e,t,n,r,s){let i=r||e.options.databaseURL;i===void 0&&(e.options.projectId||ye("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),B("Using default host for project ",e.options.projectId),i=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=Vl(i,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Vf]),c?(l=!0,i=`http://${c}?ns=${a.namespace}`,o=Vl(i,s),a=o.repoInfo):l=!o.repoInfo.secure;let u=s&&l?new Kt(Kt.OWNER):new ri(e.name,e.options,t);gf("Invalid Firebase Database URL",o),y(o.path)||ye("Database URL must point to the root of a Firebase Database (not including a child path).");let h=qf(a,e,u,new ni(e.name,n));return new Bi(h,e)}function Lf(e,t){let n=Ui[t];(!n||n[e.key]!==e)&&ye(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Rf(e),delete n[e.key]}function qf(e,t,n,r){let s=Ui[t.name];s||(s={},Ui[t.name]=s);let i=s[e.toURLString()];return i&&ye("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Li(e,Ff,n,r),s[e.toURLString()]=i,i}var Bi=class{constructor(t,n){this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(If(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new lt(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Lf(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&ye("Cannot call "+t+" on a deleted database.")}};function Gc(e=vn(),t){let n=_n(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let r=un("database");r&&$c(n,...r)}return n}function $c(e,t,n,r={}){e=fn(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&ye("Cannot call useEmulator() after instance has already been initialized.");let s=e._repoInternal,i;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&ye('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new Kt(Kt.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:hn(r.mockUserToken,e.app.options.projectId);i=new Kt(o)}Mf(s,t,n,i)}function Uf(e){Th(yn),gn(new mn("database",(t,{instanceIdentifier:n})=>{let r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return Of(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),ce(nl,rl,e),ce(nl,rl,"esm2017")}Ki.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)};Ki.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};Uf();var nn=class{constructor(t){return t}},zc="database",to=class{constructor(){return In(zc)}};var no=new on("angularfire2.database-instances");function Bf(e,t){let n=En(zc,e,t);return n&&new nn(n)}function Gf(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new nn(r)}}var $f={provide:to,deps:[[new oe,no]]},zf={provide:nn,useFactory:Bf,deps:[[new oe,no],An]},Kf=(()=>{class e{constructor(){ce("angularfire",wn.full,"rtdb")}static \u0275fac=function(r){return new(r||e)};static \u0275mod=an({type:e});static \u0275inj=sn({providers:[zf,$f]})}return e})();function Kc(e,...t){return{ngModule:Kf,providers:[{provide:no,useFactory:Gf(e),multi:!0,deps:[cn,ln,Cn,Rn,[new oe,Pn],[new oe,Tn],...t]}]}}var jc=Sn(Gc,!0);var Wc={apiKey:"AIzaSyDd_IwvcPuSI3VhjEbEK_LzS7U6FDzr8Iw",authDomain:"tpsaladejuegos-2c37d.firebaseapp.com",projectId:"tpsaladejuegos-2c37d",storageBucket:"tpsaladejuegos-2c37d.appspot.com",messagingSenderId:"17586323276",appId:"1:17586323276:web:39ad56499859f9fc9bd9e9"};var Qc={providers:[lo(So),ht(Eo(()=>Io(Wc))),ht(To(()=>Co())),ht(el(()=>tl())),ht(Kc(()=>jc()))]};var Hc=(()=>{let t=class t{constructor(){this.title="TpSalaDeJuegos"}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=ro({type:t,selectors:[["app-root"]],standalone:!0,features:[io],decls:1,vars:0,template:function(s,i){s&1&&so(0,"router-outlet")},dependencies:[ao]});let e=t;return e})();oo(Hc,Qc).catch(e=>console.error(e));
